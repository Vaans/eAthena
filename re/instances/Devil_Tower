//===== rAthena Script =======================================
//= Devil Tower
//===== Description: =========================================
//= [Walkthrough Conversion]
//= Devil Tower Instance
//===== Changelogs: ==========================================
//= 1.0 First version. [Capuche]
//= 1.1 Modificación Custom para Mind Blast/Flame Cross [Fiction]
//============================================================

dali02,134,119,5	script	Historian Shep#tnm01	4_F_NOVICE,{
	if (BaseLevel < 130) {
		mes "[Shep]";
		mes "¿Eres voluntario para explorar Devil's Tower?";
		mes "Es extremadamente peligroso, por lo que debe ser al menos ^4d4dffLevel 130^000000";
		next;
		mes "[Shep]";
		mes "¿Volverás cuando te vuelvas más fuerte?";
		mes "¿Sabes lo que quiero decir, verdad?";
		close;
	}
	switch( checkquest(7577,PLAYTIME) ) {// Tiempo de Mision
	case -1:
		break;
	case 0:
	case 1:
		mes "[Shep]";
		mes "¿Quieres explorar de nuevo tan pronto?";
		mes "Tu cuerpo necesita recuperarse del viaje en el tiempo";
		next;
		mes "[Shep]";
		mes "¡Tómate un día de descanso y vuelve mañana!";
		mes "¿Entiendes?";
		close;
	case 2:
		mes "[Shep]";
		mes "¿Has descansado lo suficiente?";
		mes "¡Yo ya me encuentro listo y dispuesto!";
		mes "¡Siempre he estado esperando a un miembro de la expedición!";
		erasequest 7577;// Space distortion
		devil_tower_can_reenter = 0;
		devil_tower_enter = 0;
		next;
		mes "! - Aviso -!";
		mes "Ahora puede volver a entrar a Devil's Tower.";
		close;
	}
	if (isbegin_quest(7576) > 0) {// instancia completada
		mes "[Shep]";
		mes "¿Entonces el tiempo y el espacio parecen haberse convergido allí?";
		mes "Estoy sorprendido de que el viaje en el tiempo sea posible";
		next;
		mes "[Shep]";
		mes "Esto es todo lo que tienes";
		mes "Hiciste un buen trabajo";
		mes "¡Espero nuevos descubrimientos!";
		setquest 7577;// Space distortion
		erasequest 7568;// Explore the tower
		erasequest 7571;// Tower Expedition
		erasequest 7574;// Thanatos Tower
		erasequest 7576;// Morocc castle seal
		getexp 450000,450000;
		devil_tower_can_reenter = 0;
		devil_tower_enter = 0;
		mes "¡Por favor, vuelve mañana!";
		close;
	}
	if (isbegin_quest(7574) > 0) {// falló después del sello
		mes "[Shep]";
		mes "Oh, has vuelto tan pronto ...";
		mes "Ok, veo lo que sucedió";
		next;
		mes "[Shep]";
		mes "Esto es todo lo que tienes";
		mes "Hiciste un buen trabajo";
		mes "¡Espero nuevos descubrimientos!";
		setquest 7577;// Space distortion
		erasequest 7568;// Explore the tower
		erasequest 7571;// Tower Expedition
		erasequest 7574;// Thanatos Tower
		getexp 300000,300000;
		devil_tower_can_reenter = 0;
		devil_tower_enter = 0;
		mes "¡Por favor, vuelve mañana!";
		close;
	}
	if (isbegin_quest(7571) > 0) {// falló en la escalera 2 tnm1
		mes "[Shep]";
		mes "Oh, has vuelto";
		mes "Déjame ver ... quieres decir que esta torre tiene un pasaje para conectarse con el mundo de los demonios";
		next;
		mes "[Shep]";
		mes "Esto es todo lo que tienes";
		mes "Hiciste un buen trabajo";
		mes "¡Espero nuevos descubrimientos!";
		setquest 7577;// Space distortion
		erasequest 7568;// Explore the tower
		erasequest 7571;// Tower Expedition
		if (isbegin_quest(7572)) erasequest 7572;// Lucile...?
		if (isbegin_quest(7573)) erasequest 7573;// Magic Swordman Thanatos
		getexp 200000,200000;
		devil_tower_can_reenter = 0;
		devil_tower_enter = 0;
		mes "¡Por favor, vuelve mañana!";
		close;
	}
	switch( checkquest(7568,PLAYTIME) ) {// entrance timer - 1h30 to enter
	case -1:
	mes "[Shep]";
	mes "¿Eres voluntario para explorar Devil's Tower? ¡He estado esperando a alguien como tú!";
	next;
	mes "[Shep]";
	mes "Finalmente, alguien para compartir los misterios de la torre";
	mes "Nadie ha sido voluntario en este punto, así que me estaba preocupando";
	next;
	mes "[Shep]";
	mes "Por favor, informe todo lo que encuentre en la torre para mí";
	mes "¡Cuanto mejor sea la información ~ mejor será el zeny, te pagaré!";
	next;
	mes "[Shep]";
	mes "Ese erudito de Laphine de allí abrirá la brecha dimensional con este dispositivo del tiempo";
	mes "Todavía es inestable, por lo que su tiempo para explorar será limitado";
	next;
	mes "[Shep]";
	mes "Si inesperadamente se recupera de nuevo aquí, debe regresar rápidamente";
	mes "Si lo hace, puede o no puede volver a ingresar, dependiendo de qué tan rápido sea";
	next;
	mes "[Shep]";
	mes "Pero si te quedas sin tiempo, el acceso a la torre desaparecerá";
	mes "Entonces, ¿quieres ser voluntario?";
		next;
		if (select( "Voluntario", "No gracias" ) == 2) {
			mes "[Shep]";
	mes "Oh, eso es muy malo";
	mes "No hay nada que pueda hacer, supongo";
	mes "Encontraré a alguien más ...";
			close;
		}
		mes "[Shep]";
	mes "Gracias";
	mes "Bien, reúna a su grupo y recuerde informarme lo que encuentre";
	next;
	mes "[Shep]";
	mes "^4d4dffEl límite de tiempo de esta travesia es por su propia seguridad ^000000!";
		setquest 7568;// Explore the tower
		close;
	case 0:
	case 1:
		if (devil_tower_can_reenter == 0)// player can re-enter
			break;h
	case 2:
		mes "[Shep]";
	mes "Parece que llegas tarde";
	mes "Has tomado demasiado tiempo.";
	mes ".....";
	mes "No puedo usar tu información actual.";
	next;
	mes "[Shep]";
	mes "No hay nada que podamos hacer";
	mes "Siempre hay oportunidades para otras expediciones";
		setquest 7577;// Space distortion
		erasequest 7568;
		if (isbegin_quest(7569)) erasequest 7569;// Treat the injured
		if (isbegin_quest(7570)) erasequest 7570;// Destroy the demons
		devil_tower_can_reenter = 0;
		devil_tower_enter = 0;
		close;
	}
	mes "[Shep]";
	mes "En primer lugar, debe reservar una entrada para poder acceder a la dimensión.";
	mes "Laphine Scholar Artie puede realizar reservaciones.";
	next;
	mes "[Shep]";
	mes "El tiempo es limitado porque el espacio dimensional sigue siendo inestable";
	mes "Haz tu exploración corta y dulce";
	next;
	mes "[Shep]";
	mes "Las recompensas serán diferentes según tu tiempo";
	mes "¡Buena suerte!";
	next;
	if (select( "¡Confía en mí!", "Cancela mi reserva" ) == 1) {
		mes "[Shep]";
	mes "Creo que puedes lograr esta travecia bajo estas restricciones";
	mes "¡Creo en ti!";
		close;
	}
	if (devil_tower_enter == 1) {
		mes "[Shep]";
	mes "Te ves un poco cansado para continuar explorando";
	mes "^4d4dffSi deseas canclear la expedición ahora, podrás ir nuevamente el día next.^000000";
	mes "¿Está bien?";
		next;
		if (select( "Sí, cancelar.", "¡Espera, no canceles!" ) == 2) {
			mes "[Shep]";
			mes "Ok, no cancelaré";
			close;
		}
		mes "[Shep]";
		mes "Realmente...";
		mes "Muy bien, vuelve mañana.";
		setquest 7577;// Space distortion
		erasequest 7568;
		if (isbegin_quest(7569)) erasequest 7569;// Treat the injured
		if (isbegin_quest(7570)) erasequest 7570;// Destroy the demons
		devil_tower_enter = 0;
		devil_tower_can_reenter = 0;
		close;
	}
	mes "[Shep]";
	mes "¿En serio?"
	mes "¿Después de escuchar toda esta explicación?";
	erasequest 7568;// Explore the tower
	close;
}

dali02,137,121,3	script	Magic Scholar Artie#tnm	4_M_FAIRYKID6,{
	.@party_id = getcharid(1);
	if (.@party_id == 0) {
	mes "[Artie]";
	mes "Divirtámonos ya que acabamos de dejar bifrost";
	mes "No?";
	mes "¿Te estás presentando como voluntario?";
	mes "Será mejor que juntes un grupo para esta expedición";
	next;
	mes "[Artie]";
	mes "No tomes ningún riesgo innecesario, ¿de acuerdo?";
	close;
	}
	if (getpartyleader(.@party_id,2) != getcharid(0)) {
		mes "[Artie]";
	mes "Debes traer al Jefe de Expedición";
	mes "Devil's Tower no es un lugar para visitar solo";
	mes "Necesito al gerente";
		close;
	}
	if (devil_tower_enter == 1) {
		mes "[Artie]";
		mes "Lo lamento, las puertas ya se encuentran cerradas.";
		mes "Intentalo más tarde.";
		close;
	}
	switch( checkquest(7568,PLAYTIME) ) {
	case 0:
	case 1:
		break;
	case -1:
	case 2:
		mes "[Artie]";
		mes "Hmm... Es muy dificil crear un vinculo con la dimensión si no existe un tiempo predeterminado de exploración de por medio.";
		mes "Lo cual lo hace muy peligroso para permitir tu acceso.";
		close;
	}
	mes "[Artie]";
	mes "¿Eres voluntario para explorar Devil's Tower?";
	mes "¿Quieres que active el Dispositivo dimensional?";
	next;
	mes "[Artie]";
	mes "Decida rápidamente porque solo tienes unos pocos segundos para elegir.";
	next;
	if (select( "Sí, active el dispositivo.", "Espere un minuto". ) == 2) {
		mes "[Artie]";
	mes "Tu tiempo para explorar está disminuyendo";
	mes "El tiempo es muy importante.";
	mes "¿Qué estás esperando?";
	close;
	}
	mes "[Artie]";
	mes "El dispositivo dimensional está activado.";
	mes "Si tienes suerte, puedes superar esto rápidamente";
	mes "Espero escuchar buenas noticias.";
	instance_create("Devil's Tower");
	close;
}

dali02,141,120,3	script	Dimensional Device#tnm0	PORTAL,{
	if (devil_tower_can_reenter == 1) {// can't re-enter
		mes "[Artie]";
	mes "Hey, Hey";
	mes "Es difícil viajar a través del dispositivo ahora mismo";
	mes "Deberíamos dejar de explorar hoy y volver otro día.";
		close;
	}
	switch( checkquest(7568,PLAYTIME) ) {
	case 0:
	case 1:
		break;
	case -1:
	case 2:
		mes "[Artie]";
		mes "Mira, lo siento pero no está permitido entrar excepto si te encuentras registrado y con el limite de tiempo establecido, Devil's Tower es muy peligroso.";
		close;
	}
	mes "[Artie]";
	mes "Sí, este es el Dispositivo dimensional";
	mes "Se usa para viajar el tiempo.";
	mes "Será difícil ingresar de nuevo si te vas";
	next;
	mes "[Artie]";
	mes "No te preocupes, soy un genio erudito ~";
	mes "De todos modos, ¿listo para entrar?";
	next;
	if (select( "Ingresar al dispositivo.", "Cancelar".) == 2) {
		mes "[Artie]";
		close;
	}
	.@md_name$ = "Devil's Tower";
	switch( instance_enter(.@md_name$) ) {
	case IE_OTHER:
		mes "Ha ocurrido un error desconocido";
		close;
	case IE_NOINSTANCE:
		mes "[Shep]";
		mes "El dispositivo dimensional debe ser activado primero antes de ser usado.";
		mes "Parece que todavía no lo has activado.";
		next;
		mes "[Shep]";
		mes "Por favor, obtenga un permiso para activarlo hablando con Magic Scholar Artie.";
		close;
	case IE_NOMEMBER:
		mes "[Artie]";
		mes "Explorar Devil's Tower será permitido solo para expediciones en grupos.";
		mes "Asegúrate de estar listo con aquello.";
		close;
	case IE_OK:
		mapannounce "dali02", "El lider " + strcharinfo(0) + " del grupo " + getpartyname( getcharid(1) ) + " han entrado a una expedición en " + .@md_name$ + "", bc_map,0xFF99;
		// warp "1@tnm1",50,104;
		devil_tower_enter = 1;
		end;
	}
}

dali02,134,112,3	script	#tnmtks01	HIDDEN_WARP_NPC,3,3,{
	end;
OnTouch_:
	disablenpc "#tnmtks01";
	initnpctimer;
	end;
OnTimer1000:
	npctalk "Artie: ¡Oye, tú! ¿Cómo va tu investigación?", "Magic Scholar Artie#tnm";
	end;
OnTimer3000:
	npctalk "Shep: ¿A quién estás llamando oye, tú? ¡Eres solo una pequeña hada polvorienta!", "Historian Shep#tnm01";
	end;
OnTimer6000:
	npctalk "Artie: ¿Un polvoriento qué? Te lo haré saber, ¡tengo genes superiores a tu especie que simulas!", "Magic Scholar Artie#tnm";
	end;
OnTimer9000:
	npctalk "Shep: ¿Qué me importa lo que dices? ¡Incluso nuestros niños son más grandes que ustedes pequeñas hadas pequeñas!", "Historian Shep # tnm01";
	end;
OnTimer12000:
	npctalk "Shep: piensa que eres tan grande solo porque eres un erudito mágico ¿eh?", "Historian Shep # tnm01";
	end;
OnTimer14000:
	npctalk "Artie: No sabes nada humano. Recuérdame de nuevo quién encontró esta entrada a la torre", "Magic Scholar Artie#tnm";
	end;
OnTimer18000:
	npctalk "Shep: * Suspiro * ... Y .... lo hiciste.", "Historian Shep#tnm01";
	end;
OnTimer21000:
	npctalk "Artie: Y .... ¿Estuviste tartamudeando? ¿Y quién resolvió la fórmula calculando la brecha dimensional conectada a la torre?", "Magic Scholar Artie#tnm";
	end;
OnTimer24000:
	npctalk "Shep: Sí, sí, fuiste tú", "Historian Shep#tnm01";
	end;
OnTimer27000:
	npctalk "Artie: Entonces, entiendo que ya no estás cuestionando cuán inteligente soy, ¿verdad?", "Magic Scholar Artie#tnm";
	end;
OnTimer30000:
	npctalk "Shep: Está bien, está bien. Necesito un aventurero para explorar la torre para nosotros", "Historian Shep # tnm01";
	end;
OnTimer33000:
	npctalk "Shep: ¡Nadie se ha ofrecido voluntario porque todos dicen que es demasiado peligroso!", "Historian Shep # tnm01";
	end;
OnTimer36000:
	npctalk "Artie: ¿No hay voluntarios? Vamos. Aproveche sus habilidades de motivación y encuentre a alguien", "Magic Scholar Artie#tnm";
	end;
OnTimer37000:
	emoción ET_KIK, getnpcid (0, "Magic Scholar Artie#tnm");
	end;
OnTimer39000:
	npctalk "Shep: ¡Hola! ¡Ahora reclutando nuevos miembros para explorar Devil's Tower!", "Historian Shep # tnm01";
	end;
OnTimer42000:
	npctalk "Shep: ¡Por favor, ven! Ahora es tu oportunidad de enfrentarte cara a cara con los infames secuaces del mismísimo Satan Morocc!", "Historian Shep#tnm01";
	end;
OnTimer45000:
npctalk "Artie: ¿Estás seguro de que esa es la mejor forma de reclutar? Quizás tus tácticas de reclutamiento necesiten ser refinadas ...", "Magic Scholar Artie#tnm";
	stopnpctimer;
	enablenpc "#tnmtks01";
	end;
}

// Entrance
1@tnm1,50,104,0	script	#event01	HIDDEN_WARP_NPC,1,1,{
	end;
OnTouch:
	disablenpc instance_npcname("#event01");
	initnpctimer;
	end;
OnTimer2000:
	npctalk "Oficial Heim: Esto es una emergencia .. ¿Cómo van las cosas?", instance_npcname("Officer Heim#heim0");
	end;
OnTimer5000:
	npctalk "Un tirailleur: El next piso es el más alto ... pero hay tantos demonios ...", instance_npcname ("A tirailleur # tnm01");
	end;
OnTimer6000:
	emotion  ET_THINK, getnpcid (0, "Oficial Heim#heim0");
	end;
OnTimer8000:
	npctalk "Un tirailleur: es imposible vencerlos con el número actual que tenemos". instance_npcname("A tirailleur#tnm01");
	emotion  ET_PROFUSELY_SWEAT, getnpcid (0, "A tirailleur # tnm01");
	end;
OnTimer11000:
	npctalk "Oficial Heim: ¿Cuántos soldados han sobrevivido ahora? ¿Cuándo llega el equipo de apoyo?", instance_npcname("Officer Heim#heim0");
	end;
OnTimer12000:
	emotion  ET_THINK, getnpcid (0, "An aide#tnm02");
	end;
OnTimer16000:
	npctalk "Un asistente: no hay suficiente para llamar ...", instance_npcname ("An aide#tnm02");
	end;
OnTimer17000:
	npctalk "Un asistente: La buena noticia es que los demonios han dejado de atacar". instance_npcname ("An aide # tnm02");
	end;
OnTimer21000:
	npctalk "Oficial Heim: No podemos estar atrapados aquí y podemos ir más allá. ¿Por qué los demonios dejaron de atacar?", instance_npcname("Officer Heim#heim0");
	end;
OnTimer24000:
	npctalk "Un tirailleur: parece que algo está sucediendo allá arriba ...", instance_npcname("A tirailleur#tnm01");
	end;
OnTimer26000:
	disablenpc instance_npcname("Officer Heim#heim0");
	enablenpc instance_npcname("Officer Heim#heim");
	npctalk "Officer Heim: ¿Quién eres tú?", instance_npcname("Officer Heim#heim");
	stopnpctimer;
	end;
}

1@tnm1,57,112,5	script	Officer Heim#heim0	4_TOWER_05,{ end; }

1@tnm1,56,110,3	script	Officer Heim#heim	4_TOWER_05,{
	if (getpartyleader(getcharid(1),2) != getcharid(0)) {
		mes "[Officer Heim]";
	mes "¿Quién los trajo a todos aquí?";
		mes "Hablaré con un representante";
		close;
	}
	switch('devil_tower) {
	mes "[Oficial Heim]";	
	mes "¿Respaldar a los soldados? Entonces, ¿por qué estás ahí parado?";
	npctalk "Oficial Heim: ¿Respaldar a los soldados? ¿Entonces por qué estás ahí parado?";
	next;
	select ("¿Ahora mismo?");
	enablenpc instance_npcname("Healer Fama#feima");
	'devil_tower = 1;
	mes "[Sanador Fama]";
	mes "Comandante, por favor, ayúdame. No puedo hacerlo solo ~!";
	npctalk "Sanador Fama: Comandante por favor ayúdame. No puedo hacerlo solo ~!", instance_npcname("Healer Fama#feima");
	next;
	mes "[Oficial Heim]";
	mes "¿Oyes eso?";
	mes "Ayuda a Fama a cuidar a los soldados heridos";
	mes "Fama te dará botiquines de primeros auxilios, úsalos para ayudar a las personas heridas";
	// close2; // todavía adjunto
	npctalk "Oficial Heim: ¿Oyes eso?";
	sleep2 2000;
	npctalk "Oficial Heim: Ayuda a Fama a cuidar a los soldados heridos";
	sleep2 2000;
	npctalk "Healer Fama: Okay ~ ¿Me vas a ayudar? Ven aquí y recibe el botiquín de primeros auxilios ~!";
	end;
	case 1:
		mes "[Officer Heim]";
	mes "Es prioritario tratar a los soldados heridos ayudando a Fama";
	mes "Haz tu mejor esfuerzo incluso si el entorno es el peor";
		close;
	default:
		mes "[Officer Heim]";
		mes "Afortunadamente, nadie está muerto todavía";
		mes "No quiero ver morir a mis soldados";
		close;
	}
}

1@tnm1,47,109,3	script	Healer Fama#feima	4_TOWER_10,{
	if ('devil_tower == 1) {
		if (countitem(7641) < 1) {
		mes "[Healer Fama]";
		mes "Por favor, debes curar a los heridos con este botiquín de primeros auxilios";
		mes "No es difícil. Solo sigue las instrucciones";
		next;
		mes "[Healer Fama]";
		mes "Estamos escasos de suministros. Así que solo podré dar uno por vez";
		mes "Si te quedas sin botiquin, con gusto te podré dar otro.";
			getitem 7641,1;// Medical_Cure_Box
			close;
		}
		mes "[Healer Fama]";
		mes "Lo siento ... las compras no son buenas ahora, así que solo puedo proporcionar un botiquín de primeros auxilios a la vez";
		close;
	}
	mes "[Healer Fama]";
		mes "Huh ... Bien, podemos tomar un descanso ahora";
		mes "¡Muchas gracias!";
	close;
}

1@tnm1,39,114,3	script	Injured Soldier#1_1	4_TOWER_01,3,3,{
	if ('devil_tower != 1)
		end;
	if (countitem(7641) < 1) {
		mes "Necesito 1 botiquín de primeros auxilios para tratar al soldado herido";
		close;
	}
	mes "Este soldado ha perdido la conciencia y está gimiendo";
	mes "¿Debo usar el botiquín de primeros auxilios?";
	next;
	if (select( "Usar el botiquín de primeros auxilios "," Observa la condición." ) == 2) {
	mes "Decides observar más la condición del soldado herido";
		close;
	}
	mes "Administras el botiquín de primeros auxilios al soldado";
	next;
	specialeffect EF_SPHERE;
	progressbar "000000",1;
	delitem 7641,1;
	specialeffect EF_ENTRY;
	disablenpc instance_npcname( strnpcinfo(0) );
	enablenpc instance_npcname( strnpcinfo(1) + "#" + replacestr( strnpcinfo(2), "_1", "" ) );
	specialeffect EF_ENTRY,AREA, instance_npcname( strnpcinfo(1) + "#" + replacestr( strnpcinfo(2), "_1", "" ) );
	mes "¡Funciona!.";
	'heal_count++;
	if ('heal_count == 7) {
		'devil_tower = 2;
		npctalk "Healer Fama: ¿Asesinos?", instance_npcname("Healer Fama#feima");
		enablenpc instance_npcname("Lucile#tnm01");
		enablenpc instance_npcname("Magic Swordman#tnm01");
		enablenpc instance_npcname("Assassin Huey#tnm01");
		enablenpc instance_npcname("Assassin Louie#tnm01");
	}
	close;

OnTouch:
	.@num = atoi( replacestr( strnpcinfo(2), "_1", "" ) );
	if (.@num == 1)
		npctalk "Injured Soldier: Gemidos....";
	else if (.@num == 2)
		npctalk "Injured Soldier: Owww...";
	else if (.@num == 3)
		npctalk "Injured Soldier: .... aah.. aah..";
	else if (.@num == 4)
		npctalk "Injured Soldier: Owww...";
	else if (.@num == 5)
		npctalk "Injured Soldier: No quiero morir...";
	else if (.@num == 6)
		npctalk "Injured Soldier: Owww~";
	else
		npctalk "Injured Soldier: Gemidos...";
	end;
}

1@tnm1,30,120,3	duplicate(Injured Soldier#1_1)	Injured Soldier#2_1	4_TOWER_03,3,3
1@tnm1,25,117,5	duplicate(Injured Soldier#1_1)	Injured Soldier#3_1	4_TOWER_06,3,3
1@tnm1,19,118,4	duplicate(Injured Soldier#1_1)	Injured Soldier#4_1	4_TOWER_08,3,3
1@tnm1,18,110,4	duplicate(Injured Soldier#1_1)	Injured Soldier#5_1	4_TOWER_11,3,3
1@tnm1,24,104,7	duplicate(Injured Soldier#1_1)	Injured Soldier#6_1	4_TOWER_13,3,3
1@tnm1,31,110,3	duplicate(Injured Soldier#1_1)	Injured Soldier#7_1	4_TOWER_03,3,3

1@tnm1,39,114,3	script	Injured Soldier#1	4_TOWER_02,{
	mes "[Injured soldiers]";
	mes "whew .. parece estar bien ahora.";
	mes "Gracias";
	close;
}

1@tnm1,30,120,3	script	Injured Soldier#2	4_TOWER_04,{
	mes "[Injured soldiers]";
	mes "Gimiendo ... Solo déjame morir.";
	mes "No duele demasiado";
	close;
}

1@tnm1,25,117,5	script	Injured Soldier#3	4_TOWER_07,{
	mes "[Injured soldiers]";
	mes "Su conciencia parece estar aún borrosa";
	mes "Déjalo descansar un poco";
	close;
}

1@tnm1,19,118,4	script	Injured Soldier#4	4_TOWER_09,{
	mes "[Injured soldiers]";
	mes "pensé que iba a morir";
	mes "¡Pero estoy vivo!";
	close;
}

1@tnm1,18,110,4	script	Injured Soldier#5	4_TOWER_12,{
	mes "[Injured soldiers]";
	mes "No puedo morir aquí. Tengo que proponerle a mi amado cuando llegue a casa";
	mes "Estaremos felices de seguro?";
	close;
}

1@tnm1,24,104,7	script	Injured Soldier#6	4_TOWER_14,{
	mes "[Injured soldiers]";
	mes "Me siento mucho mejor pero aún no puedo moverme";
	mes "Todavía tengo suerte de estar vivo.";
	close;
}

1@tnm1,31,110,3	script	Injured Soldier#7	4_TOWER_04,{
	mes "[Injured soldiers]";
	mes "Gracias .. Gracias ...";
	close;
}

1@tnm1,61,110,3	script	An aide#tnm02	4_M_MOCASS2,{
	mes "[An aide]";
	mes "La calamidad que ocurrió hace cientos de años no volverá a ocurrir ¿verdad?";
	mes "¿Por qué los demonios han aparecido de nuevo tan repentinamente?";
	close;
}

1@tnm1,61,113,3	script	A tirailleur#tnm01	4_M_MOCASS1,{
	mes "[A tirailleur]";
	mes "¿Eres miembro del equipo de respaldo?";
	mes "Bien, las cosas están empeorando aquí";
	mes "Me alegro de que todos estén aquí para ayudar";
	close;
}

1@tnm1,46,105,5	script	Lucile#tnm01	4_F_LUCILE,{
	if (getpartyleader(getcharid(1),2) != getcharid(0)) {
		cutin "tnm_lucile01.bmp",2;
		mes "[Lucile]";
		mes "¿Quién está a cargo del equipo de respaldo?";
		close3;
	}
	if ('devil_tower == 2) {
		.@lucile$ = instance_npcname("Lucile#tnm01");
		.@heim$ = instance_npcname("Officer Heim#heim");
		
		'devil_tower = 3;
		mes "";	// todo fix me "workinprogress"
		cutin "tnm_lucile01.bmp",2;
		sleep2 1500;
		npctalk "Lucile: soy Lucile del Assassin Guild.",.@lucile$;
		sleep2 2000;
		npctalk "Oficial Heim: Nuestro respaldo es de Assassin Guild? Gracias por llegar a tiempo.",.@heim$;
		sleep2 3000;
		npctalk "Lucile: La situación no parece ser buena.",.@lucile$;
		sleep2 3000;
		npctalk "Lucile: ¿Qué pasó con los valientes caballeros de Prontera?",.@lucile$;
		sleep2 3000;
		npctalk "Oficial Heim: ¿Te estás burlando de mí?",.@heim$;
		sleep2 3000;
		npctalk "Lucile: Para nada. Realmente quiero saber. ¿Qué está pasando arriba?",.@lucile$;
		sleep2 2500;
		emoción ET_OHNO,.@heim$;
		sleep2 1000;
		npctalk "Oficial Heim: ¿Cómo lo supo? Sí, los demonios han detenido su ataque desde el piso de arriba".@heim$;
		sleep2 3000;
		emoción ET_SMILE,.@lucile$;
		npctalk "Lucile: ¿Qué piensas de la situación Magic Swordman?",.@lucile$;
		cutin "tnm_lucile01.bmp", 0;
		sleep2 3000;
		npctalk "Magic swordman: Hmm, iré a investigar", instance_npcname("Magic Swordman#tnm01");
		cutin "tnm_loki.bmp", 2;
		sleep2 2000;
		cutin "", 255;
		disablenpc instance_npcname("Magic Swordman#tnm01");
		sleep2 1000;
		npctalk "Lucile: ¿Cómo estás tan rápido?",.@lucile$;
		cutin "tnm_lucile01.bmp", 2;
		sleep2 2000;
		npctalk "Oficial Heim: ¿Qué estás haciendo? Si vas solo, ¡te matarán!",.@heim$;
		sleep2 3000;
		npctalk "Lucile: No estaré solo. ¡Todavía hay algunos soldados ilesos!",.@lucile$;
		sleep2 2500;
		npctalk "Lucile: Está bien, te pediré que me respaldes. ¿De acuerdo, Dewey?",.@lucile$;
		sleep2 500;
		enablenpc instance_npcname("Assassin Dewey#tnm01");
		enablenpc instance_npcname("#tnm1stepmob");
		npctalk "Dewey: Bien, lo haré.", instance_npcname("Assassin Dewey # tnm01");
		'devil_tower = 4;
		sleep2 500;
		cutin "", 255;
		disablenpc.@lucile$;
		disablenpc instance_npcname("Assassin Huey # tnm01");
		disablenpc instance_npcname("Assassin Louie # tnm01");
		sleep2 2000;
		npctalk "Oficial Heim: Son tan impredecibles. ¿Sabes lo que está sucediendo bien? Haz copias de seguridad ...",.@heim$;
		sleep2 2500;
		npctalk "Oficial Heim: Ayúdanos a cuidar a los demonios que bajan del piso de arriba.", instance_npcname("Officer Heim # heim");
		end;
	}
}

1@tnm1,52,104,2	duplicate(Officer Heim#heim0)	Magic Swordman#tnm01	4_M_ROKI
1@tnm1,42,104,4	duplicate(Officer Heim#heim0)	Assassin Huey#tnm01	4_TOWER_15
1@tnm1,44,101,5	duplicate(Officer Heim#heim0)	Assassin Louie#tnm01	4_M_ACROSS

1@tnm1,70,108,3	script	Assassin Dewey#tnm01	4_M_ACROSS,{
	if ('devil_tower < 4)
		end;
	if (isbegin_quest(7569) == 0)
		setquest 7569;// Treat the injured
	if (isbegin_quest(7570) == 0)
		setquest 7570;// Destroy the demons
	mes "[Dewey]";
	mes "Te guiaré al piso superior";
	mes "No olvides deshacerse de cualquier demonio que encuentres en el camino";
	next;
	if (select( "Ir Ahora", "Necesito más tiempo para prepararme". ) == 2) {
		mes "[Dewey]";
		mes "Prepárate para cualquier cosa.";
		close;
	}
	mes "[Dewey]";
	mes "Viaja con cuidado.";
	close2;
	warp 'map_tnm1$,91,23;
	devil_tower_can_reenter = 1;// nb. different from official (condition overcomplicated)
	end;
}

// Stairs tnm1
// spawn inaccurate
1@tnm1,91,23,0	script	#tnm1stepmob	HIDDEN_WARP_NPC,1,1,{
	end;
OnTouch:
	if ('devil_tower != 4)
		end;
	disablenpc instance_npcname("#tnm1stepmob");
	enablenpc instance_npcname("Assassin Louie#tnm02");
	enablenpc instance_npcname("Lucile#tnm02");
	initnpctimer;
	monster 'map_tnm1$,99,24,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	'mob_id = $@mobid[0];
	end;
OnTimer2000:
	if (unitexists('mob_id) == true)
		unittalk 'mob_id, "¿Que es esto? ¿Un humano? ¡Cómo se atreven!, ¡¿Acaso perdieron la cabeza?!";
	end;
OnTimer5000:
	monster 'map_tnm1$,103,21,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	unittalk $@mobid[0], "¿Hiciste una resolución?";
	monster 'map_tnm1$,103,26,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	unittalk $@mobid[0], "Ja, ja, ja .... ¡¡Luchamos ... !!!";
	end;
OnTimer11000:
	monster 'map_tnm1$,106,25,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,106,27,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,110,20,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,112,24,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,107,22,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	monster 'map_tnm1$,114,24,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	end;
OnTimer17000:
	monster 'map_tnm1$,120,20,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,122,23,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	end;
OnTimer23000:
	monster 'map_tnm1$,116,25,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,116,21,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	end;
OnTimer29000:
	monster 'map_tnm1$,134,21,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,130,25,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,129,27,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,120,27,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	monster 'map_tnm1$,118,22,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	end;
OnTimer35000:
	monster 'map_tnm1$,138,27,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,144,23,"Evil Shadow",2939,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,129,20,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	end;
OnTimer41000:
	monster 'map_tnm1$,140,24,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,144,20,"Evil Shadow",2940,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,130,27,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	monster 'map_tnm1$,127,24,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	monster 'map_tnm1$,142,27,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	monster 'map_tnm1$,140,22,"Evil Shadow",2941,1, instance_npcname("#tnm1stepmob") + "::OnMobDead";	// MM_EVIL_SHADOW3
	stopnpctimer;
	end;
OnMobDead:
	end;
}

1@tnm1,158,24,3	script	Assassin Louie#tnm02	4_M_ACROSS,{
	if ('devil_tower < 4)
		end;
	if (checkquest(7570,HUNTING) != 2) {
		mes "[Louie]";
		mes "El Capitán dice que tenemos que deshacernos de todos los demonios ...";
		mes "Será mejor hacerlo.";
		close;
	}
	mes "[Louie]";
	mes "Muchos soldados sobrevivieron a los ataques";
	mes "Se deshicieron de todos los demonios";
	next;
	mes "[Louie]";
	mes "Me estaba asegurando de que nadie subiera las escaleras, temía que algo volviera a pasar.";
	next;
	mes "[Louie]";
	mes "Me gustaría que me ayudaras";
	mes "Te guiaré";
	if (isbegin_quest(7571) == 0) {
		erasequest 7569;// Treat the injured
		erasequest 7570;// Destroy the demons
		setquest 7571;// Tower Expedition
	}
	next;
	mes "He estado explorando los pasajes de esta torre desde hace un tiempo";
	close2;
	warp 'map_tnm1$,124,86;
	end;
}

// Stairs 2 tnm1
1@tnm1,138,96,3	script	Lucile#tnm02	4_F_LUCILE,{
	if (isbegin_quest(7571) == 0)
		end;
	if (getpartyleader(getcharid(1),2) != getcharid(0)) {
		mes "Agitas tu mano frente a ella pero ella no reacciona";
		close;
	}
	if ('devil_tower < 4)
		end;
	if ('devil_tower < 6) {
		if ('devil_tower == 4) {
			mes "[Lucile]";
		mes "Lo siento si te estoy dando algun problema, pero es que no puedo moverme.";
		npctalk "Lucile: Lo siento si te estoy dando algun problema, pero es que no puedo moverme";
		cutin "tnm_lucile02.bmp", 2;
		next;
		select("¿Puedo ayudarte?");
		mes "[Lucile]";
		mes "Puedo usar la auto recuperación pero no tengo tiempo para eso";
		mes "¿Compartirás tu poder conmigo?";
		npctalk "Lucile: Puedo usar la autorecuperación pero no tengo tiempo para eso. ¿Compartirás tu poder conmigo?";
		next;
		mes "[Lucile]";
		mes "Necesito tu ayuda para activar mi sistema de restauración";
		mes "Por favor, agárrate fuerte";
		npctalk "Lucile: necesito tu ayuda para activar mi sistema de restauración";
		next;
		sleep2 750;
		npctalk "Lucile: Por favor, agárrate fuerte";
			donpcevent instance_npcname("Huey#hui02") + "::OnEnable";
			'devil_tower = 5;
			percentheal -30,0;
		}
		cutin "tnm_lucile03.bmp",2;
		mes "Lucile parece ser una máquina.";
		mes "Puedo escuchar sonidos mecánicos de repente.";
		specialeffect EF_LEVEL99_3;
		progressbar "000000",40;
		if (isbegin_quest(7572) == 0)
			setquest 7572;// Lucile...?
		mes "System is restored.";
		'devil_tower = 6;
		next;
		mes "[Lucile]";
		mes "¡Guau! Lo has arreglado más rápido de lo que pensaba";
		mes "¿Eso te sorprendió?";
		mes "Debo arreglarlo ocasionalmente porque no tengo un cuerpo normal";
		cutin "tnm_lucile02.bmp",2;
		next;
		mes "[Lucile]";
		mes "Este cuerpo fue un regalo de los dioses";
		mes "¿Ves la puerta en el medio?";
		cutin "tnm_lucile01.bmp",2;
		next;
		mes "[Lucile]";
		mes "Date prisa o este mundo estará en peligro.";
		close2;
		cutin "",255;
		// continue
	}
	if ('devil_tower == 6) {
		sleep 1500;
		npctalk "Lucile: Permíteme disculparme, sígueme si quieres salvar el mundo";
		sleep 2000;
		npctalk "Huey: hermana...", instance_npcname("Huey#hui02");
		disablenpc instance_npcname("Lucile#tnm02");
		enablenpc instance_npcname("Lucile#tnm03");
		enablenpc instance_npcname("Magic Swordman#tnm02");
		enablenpc instance_npcname("Demon Morocc#tnm01");
		'devil_tower = 7;
	}
	end;
}
	
1@tnm1,135,99,5	script	Huey#hui02	4_TOWER_15,{
	if ('devil_tower < 5)
		end;
	if ('devil_tower == 5 || 'devil_tower == 6) {
		mes "[Huey]";
		mes "Estoy preocupado por ella";
		mes "Sucede cada vez que está herida";
		mes "Porque ella es principalmente máquina ...";
		close;
	}
	if ('mob_count > 0) {
		mes "[Huey]";
		mes "Conozco el camino de arriba ...";
	mes "¡Antes que todo, tenemos que deshacernos de estos demonios!";
		close;
	}
	mes "[Huey]";
	mes "Me pregunto cómo están haciendo los otros ...";
	mes "Solo Thanatos y Lucile han entrado alguna vez al piso superior ...";
	next;
	mes "[Huey]";
	mes "Si quieres ayudarlos, debes apresurarte";
	mes "Yo te guiaré, sigueme.";
	next;
	if (select( "Mover de inmediato", "No seguir". ) == 2) {
		mes "[Huey]";
		mes "...Ya veo.";
		close;
	}
	mes "[Huey]";
	mes "Por aquí..";
	mes "Con cuidado.";
	close2;
	warp 'map_tnm2$,152,130;
	end;

OnEnable:
	enablenpc instance_npcname("Huey#hui02");
	initnpctimer;
	end;
OnTimer3000:
	npctalk "Huey: ¡Oh, no, hermana ten cuidado! Los demonios han aparecido de repente!";
	'mob_count = 16;
	monster 'map_tnm1$,142,90,"Evil Shadow",2939,1, instance_npcname("Huey#hui02") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,139,91,"Evil Shadow",2940,1, instance_npcname("Huey#hui02") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,130,86,"Evil Shadow",2940,1, instance_npcname("Huey#hui02") + "::OnMobDead";
	monster 'map_tnm1$,143,95,"Evil Shadow",2941,1, instance_npcname("Huey#hui02") + "::OnMobDead";	// MM_EVIL_SHADOW3
	monster 'map_tnm1$,134,90,"Evil Shadow",2941,1, instance_npcname("Huey#hui02") + "::OnMobDead";
	end;
OnTimer6000:
	npctalk "Huey: ¿De dónde están viniendo? Demonios otra vez......";
	end;
OnTimer8000:
	monster 'map_tnm1$,137,103,"Evil Shadow",2939,1, instance_npcname("Huey#hui02") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,140,102,"Evil Shadow",2939,1, instance_npcname("Huey#hui02") + "::OnMobDead";
	monster 'map_tnm1$,132,103,"Evil Shadow",2940,1, instance_npcname("Huey#hui02") + "::OnMobDead";	// MM_EVIL_SHADOW2
	monster 'map_tnm1$,146,100,"Evil Shadow",2940,1, instance_npcname("Huey#hui02") + "::OnMobDead";
	monster 'map_tnm1$,142,105,"Evil Shadow",2940,1, instance_npcname("Huey#hui02") + "::OnMobDead";
	monster 'map_tnm1$,135,107,"Evil Shadow",2941,1, instance_npcname("Huey#hui02") + "::OnMobDead";	// MM_EVIL_SHADOW3
	end;
OnTimer11000:
	npctalk "Huey: Oh, no...";
	end;
OnTimer12000:
	monster 'map_tnm1$,135,107,"Evil Shadow",2939,1, instance_npcname("Huey#hui02") + "::OnMobDead";	// MM_EVIL_SHADOW1
	monster 'map_tnm1$,146,100,"Evil Shadow",2939,1, instance_npcname("Huey#hui02") + "::OnMobDead";
	monster 'map_tnm1$,130,86,"Evil Shadow",2940,1, instance_npcname("Huey#hui02") + "::OnMobDead";		// MM_EVIL_SHADOW2
	monster 'map_tnm1$,137,103,"Evil Shadow",2940,1, instance_npcname("Huey#hui02") + "::OnMobDead";
	monster 'map_tnm1$,143,95,"Evil Shadow",2941,1, instance_npcname("Huey#hui02") + "::OnMobDead";		// MM_EVIL_SHADOW3
	stopnpctimer;
	end;
OnMobDead:
	'mob_count--;
	if ('mob_count == 0)
		npctalk "Huey: De esta manera. De esta manera ... ¡podemos subir las escaleras usando la brecha de la cual venían los demonios!";
	end;
}

// Morocc - Thanatos Battle
1@tnm2,136,139,3	script	Magic Swordman#tnm02	THANATOS_KEEP,{
	mes "[Magic Swordman Thanatos]";
	mes "Lo siento pero he pasado por momentos difíciles ...";
	close;
}

1@tnm2,133,139,5	duplicate(Officer Heim#heim0)	Demon Morocc#tnm01	1916

1@tnm2,144,137,3	script	Lucile#tnm03	4_F_LUCILE,{
	if (getpartyleader(getcharid(1),2) != getcharid(0)) {
		mes "[Lucile]";
		mes "Estoy hablando con el líder de tu grupo ahora, así que por favor da un paso atrás por un tiempo";
		cutin "tnm_lucile01.bmp",2;
		close3;
	}
	if ('devil_tower == 7) {
		mes "[Lucile]";
		mes "Oh. Acaba de llegar a tiempo.";
	mes "¿Quieres echar un vistazo allí?";
		cutin "tnm_lucile01.bmp",2;
		next;
		mes "[Lucile]";
		mes "Necesitamos detener al demonio ...";
		mes "¿Puedes hacer eso?";
		npctalk "Lucile: Necesitamos detener al demonio ... ¿Puedes hacer eso?";
		if (isbegin_quest(7573) == 0)
			setquest 7573;// Magic Swordman Thanatos
		'demon$ = instance_npcname("Demon Morocc#tnm01");
		'thanatos$ = instance_npcname("Magic Swordman#tnm02");
		initnpctimer;
		'devil_tower = 8;
		close3;
	}
	mes "[Lucile]";
	mes "Necesitamos mantener este lugar hasta que el Swordman mágico establezca la trampa";
	cutin "tnm_lucile01.bmp",2;
	close3;

OnTimer2000:
	npctalk "Demon Morocc: Eres un humano tonto. ¿Cuánto tiempo piensas que puedes lograr atarme?", 'demon$;
	end;
OnTimer5000:
	npctalk "Demon Morocc: ¡Sombras! ¡Ven y mata a todos los enemigos de la oscuridad!", 'demon$;
	end;
OnTimer6000:
	donpcevent instance_npcname("#devil_seal_timer") + "::OnStart";
	end;
OnTimer8000:
	npctalk "Thanatos: Estás tan desesperado que me suplicas que te salve", 'thanatos$;
	end;
OnTimer11500:
	npctalk "Lucile: Thanatos. Señor, ¿debería estar mintiendo de esa manera?";
	end;
OnTimer12000:
	npctalk "Demon Morocc: ¡Temed a la destrucción que traeré cuando sea liberado!", 'demon$;
	end;
OnTimer15000:
	npctalk "Thanatos: ¡Cállate! ¡Nunca te irás de aquí a menos que te mate!", 'thanatos$;
	end;
OnTimer16500:
	npctalk "Thanatos: ¡Lucile! ¡Mira mi espalda mientras conjuro un escudo para sostenerlo!", 'thanatos$;
	end;
OnTimer19500:
	npctalk "Lucile: Yes sir.";
	end;
OnTimer22500:
	npctalk "Lucile: De acuerdo, todos, ahora sabemos qué hacer. ¡Tenemos que evitar que el Sello Mágico llegue aquí!";
	stopnpctimer;
	end;
}

1@tnm2,1,1,0	script	#devil_flamecross	HIDDEN_WARP_NPC,{
	end;
OnStart:
	npctalk "Demon Morocc: ¡De ninguna manera! ¡Basuras!", 'demon$;
	mapannounce 'map_tnm2$, "Demon Morocc: ¡De ninguna manera! ¡Basuras!", bc_map,0xFF0000;
	initnpctimer;
	end;
OnTimer1000:
	setarray .@north[0], 138,151, 138,160, 140,165, 140,176, 140,170, 140,181, 140,186, 140,191;
	setarray .@north_west[0], 126,149, 122,151, 118,153, 113,154, 107,156, 101,158, 96,160, 91,161, 86,162, 81,163;
	setarray .@south_west[0], 128,130, 125,127, 122,124, 118,121, 115,118, 112,115, 109,114, 106,106, 102,102, 99,98;
	setarray .@south_east[0], 145,130, 148,126, 151,122, 156,120, 160,117, 164,113, 168,109, 172,105, 176,101, 180,97;
	setarray .@north_east[0], 146,149, 148,149, 150,151, 155,152, 162,153, 167,154, 173,156, 179,158, 185,160, 191,161;
	.@label$ = instance_npcname("#devil_flamecross") + "::OnFlameDead";
	for ( .@i = 0; .@i < 20; .@i += 2 ) {
		if (.@north[.@i] > 0)	// 8 mobs for north
			monster 'map_tnm2$,.@north[.@i],.@north[.@i+1], "",2960,1, .@label$;
		monster 'map_tnm2$,.@north_west[.@i],.@north_west[.@i+1], "",2960,1, .@label$;
		monster 'map_tnm2$,.@south_west[.@i],.@south_west[.@i+1], "",2960,1, .@label$;	
		monster 'map_tnm2$,.@south_east[.@i],.@south_east[.@i+1], "",2960,1, .@label$;	
		monster 'map_tnm2$,.@north_east[.@i],.@north_east[.@i+1], "",2960,1, .@label$;	
			'Flame[.@i] = $@mobid[0];
			getunitdata 'Flame[.@i],.@flame_data;
			.@x = .@flame_data[UMOB_X];
			.@y = .@flame_data[UMOB_Y];
	unitskillusepos 'Flame[.@i], 535, 10,.@x,.@y,-100;
		
	}
	end;
OnTimer6000:
	killmonster 'map_tnm2$, instance_npcname("#devil_flamecross") + "::OnFlameDead";
	end;
OnTimer20000:
	stopnpctimer;
	donpcevent instance_npcname("#devil_flamecross") + "::OnStart";
	end;
OnStop:
	stopnpctimer;
	killmonster 'map_tnm2$, instance_npcname("#devil_flamecross") + "::OnFlameDead";
	end;
OnFlameDead:
	end;
}

1@tnm2,1,1,0	script	#devil_seal_timer	HIDDEN_WARP_NPC,{
	end;
OnStart:
	enablenpc instance_npcname("#devil_seal_timer");
	enablenpc instance_npcname("#devil_flamecross");
	for ( .@i = 1; .@i < 6; .@i++ ) {
		enablenpc instance_npcname("devil_seal_spawn#" + .@i);
		enablenpc instance_npcname("devil_seal_reach_center#" + .@i);
	}
	enablenpc instance_npcname("#devil_seal_dead");
	donpcevent instance_npcname("#devil_seal_spawn_global") + "::OnCoord";
	initnpctimer;
	end;
OnTimer5000:
	mapannounce 'map_tnm2$, "Un Sello Mágico acaba de aparecer en la dirección sureste de la torre.", bc_map,0xFFFFFF;
	donpcevent instance_npcname("#devil_seal_spawn_global") + "::OnFirstSpawn";
	end;
OnTimer10000:
	donpcevent instance_npcname("#devil_flamecross") + "::OnStart";
	end;
OnTimer25000:
	mapannounce 'map_tnm2$, "Lucile: Deberíamos detenerlo antes de que el Magic Seal comience a moverse nuevamente.", bc_map,0xFFFFFF;
	end;
OnTimer65000:
	mapannounce 'map_tnm2$, "Lucile: Deberíamos detener que el Magic Seal llegue al centro", bc_map,0xFFFFFF;
	end;
OnTimer95000:
	mapannounce 'map_tnm2$, "Lucile: El Magic Seal comienza a moverse de nuevo.", bc_map,0xFFFFFF;
	end;
OnTimer125000:
	mapannounce 'map_tnm2$, "Lucile: Esta demasiado  cerca ... No ... Es muy peligroso.", bc_map,0xFFFFFF;
	end;
OnTimer155000:
	mapannounce 'map_tnm2$, "Lucile: ¡El Sello Mágico casi se acerca al centro!!", bc_map,0xFFFFFF;
	end;
OnTimer180000:
	donpcevent instance_npcname("#devil_flamecross") + "::OnStop";
	end;
OnTimer185000:
	mapannounce 'map_tnm2$, "Lucile: ¡Deberíamos detenerlo ahora!", bc_map,0xFFFFFF;
	end;
OnTimer191000:
	npctalk "Thanatos: ¡¡¡Qué estás haciendo!!! ¿Estás jugando un juego ahora?", 'thanatos$;
	mapannounce 'map_tnm2$, "Thanatos: ¡¡¡Qué estás haciendo!!! ¿Estás jugando un juego ahora?", bc_map,0xFF00;
	end;
OnTimer193000:
	specialeffect EF_MAGNUMBREAK,AREA, 'thanatos$;
	specialeffect EF_LORD,AREA, 'thanatos$;
	donpcevent instance_npcname("devil_seal_spawn#1") + "::OnStop";
	donpcevent instance_npcname("devil_seal_spawn#2") + "::OnStop";
	donpcevent instance_npcname("devil_seal_spawn#3") + "::OnStop";
	donpcevent instance_npcname("devil_seal_spawn#4") + "::OnStop";
	donpcevent instance_npcname("devil_seal_spawn#5") + "::OnStop";
	end;
OnTimer195000:
	npctalk "Demon Morocc: ¿Me seguirás molestando?", 'demon$;
	mapannounce 'map_tnm2$, "Demon Morocc: ¿Me seguirás molestando?", bc_map,0xFF0000;
	end;
OnTimer198000:
	npctalk "Demon Morocc: De acuerdo, ¡veamos quién va a ganar! ¡Salgan!", 'demon$;
	mapannounce 'map_tnm2$, "De acuerdo, ¡veamos quién va a ganar! ¡Salgan!", bc_map,0xFF0000;
	end;
OnTimer201000:
	npctalk "Thanatos: ¡Será lo mismo sin importar cuántas veces lo intentes! ¡Renuncia y regresa al mundo de los demonios!", 'thanatos$;
	mapannounce 'map_tnm2$, "Thanatos: ¡Será lo mismo sin importar cuántas veces lo intentes! ¡Renuncia y regresa al mundo de los demonios!", bc_map,0xFF00;
	initnpctimer;
	end;
OnStop:
	stopnpctimer;
	donpcevent instance_npcname("#devil_flamecross") + "::OnStop";
	disablenpc instance_npcname("#devil_flamecross");
	disablenpc instance_npcname("#devil_seal_timer");
	end;
}

1@tnm2,1,1,0	script	#devil_seal_spawn_global	HIDDEN_WARP_NPC,{
	end;
OnCoord:
	enablenpc instance_npcname("#devil_seal_spawn_global");
	// setarray 'coord_seal_1[0],  68,167,	 78,165,	88,163,		98,160,		108,156,	118,152,	127,147;
	setarray 'coord_seal_1[0],  68,167,	 78,165,	88,163,		98,160,		108,156,	118,152,	118,152;// officially
	setarray 'coord_seal_2[0],  90, 86,	 96, 95,	103,103,	110,110,	116,116,	122,122,	129,130;
	setarray 'coord_seal_3[0], 191,86,	183, 94,	174,103,	165,112,	156,120,	147,128,	143,131;
	setarray 'coord_seal_4[0], 197,162,	188,161,	179,158,	170,155,	161,152,	152,149,	144,148;
	setarray 'coord_seal_5[0], 142,214,	140,205,	140,195,	140,185,	140,173,	139,161,	138,150;
	end;
OnFirstSpawn:
	'round[0] = 'round[1] = 'round[2] = 'round[3] = 'round[4] = 0;
	donpcevent instance_npcname("devil_seal_spawn#1") + "::OnFirstSpawn";
	donpcevent instance_npcname("devil_seal_spawn#2") + "::OnFirstSpawn";
	donpcevent instance_npcname("devil_seal_spawn#3") + "::OnFirstSpawn";
	donpcevent instance_npcname("devil_seal_spawn#4") + "::OnFirstSpawn";
	donpcevent instance_npcname("devil_seal_spawn#5") + "::OnFirstSpawn";
	initnpctimer;
	end;
OnTimer2000:
	donpcevent instance_npcname("devil_seal_spawn#1") + "::OnSlaves";
	donpcevent instance_npcname("devil_seal_spawn#2") + "::OnSlaves";
	donpcevent instance_npcname("devil_seal_spawn#3") + "::OnSlaves";
	donpcevent instance_npcname("devil_seal_spawn#4") + "::OnSlaves";
	donpcevent instance_npcname("devil_seal_spawn#5") + "::OnSlaves";
	end;
OnTimer20000:
	donpcevent instance_npcname("devil_seal_spawn#1") + "::OnStart";// upper left
	donpcevent instance_npcname("devil_seal_spawn#3") + "::OnStart";// bottom right
	donpcevent instance_npcname("devil_seal_spawn#5") + "::OnStart";// upper
	end;
OnTimer30000:
	donpcevent instance_npcname("devil_seal_spawn#2") + "::OnStart";// bottom left
	donpcevent instance_npcname("devil_seal_spawn#4") + "::OnStart";// upper right
	end;
OnStop:
	stopnpctimer;
	disablenpc instance_npcname("#devil_seal_spawn_global");
	end;
}

1@tnm2,1,1,0	script	devil_seal_spawn#1	HIDDEN_WARP_NPC,{
	end;
OnStart:
	.@num = atoi(strnpcinfo(2)) - 1;
	if ('seal_id[.@num] == 0 || unitexists('seal_id[.@num]) == 0)
		stopnpctimer;
	else {
		getunitdata 'seal_id[.@num], .@data;
		'seal_hp[.@num] = .@data[UMOB_HP];
		killmonster 'map_tnm2$, instance_npcname("#devil_seal_dead") + "::OnSealDead" + strnpcinfo(2);
		initnpctimer;
	}
	end;
OnFirstSpawn:
OnTimer5000:
	.@num = atoi(strnpcinfo(2)) - 1;
	.@index = 'round[.@num] * 2;
	if (.@index == 0 || 'seal_id[.@num]) {
		.@x = getd( "'coord_seal_" + (.@num+1) + "[" + .@index + "]" );
		.@y = getd( "'coord_seal_" + (.@num+1) + "[" + (.@index+1) + "]" );

		monster 'map_tnm2$,.@x,.@y,"Magic Seal",2938,1, instance_npcname("#devil_seal_dead") + "::OnSealDead" + (.@num+1);	// MM_MAGIC_SEAL
		'seal_id[.@num] = $@mobid[0];
		if (.@index == 0)
			setunitdata 'seal_id[.@num], UMOB_HP, 3000000;
		else if ('seal_hp[.@num] > 0)
			setunitdata 'seal_id[.@num], UMOB_HP, 'seal_hp[.@num];
		else
			stopnpctimer;
		'round[.@num]++;
		if ('round[.@num] == 7)
			donpcevent instance_npcname("devil_seal_reach_center#" + (.@num+1)) + "::OnStart";
	}
	end;
OnSlaves:
OnTimer7000:
	killmonster 'map_tnm2$, instance_npcname(strnpcinfo(0)) + "::OnMobDead";
	.@num = atoi(strnpcinfo(2)) - 1;
	if ('seal_id[.@num] && unitexists('seal_id[.@num])) {
		.@index = ('round[.@num] - 1) * 2;
		.@x = getd( "'coord_seal_" + (.@num+1) + "[" + .@index + "]" );
		.@y = getd( "'coord_seal_" + (.@num+1) + "[" + (.@index+1) + "]" );
		areamonster 'map_tnm2$,(.@x-1),(.@y-1),(.@x+1),(.@y+1),"Evil Shadow",2939,2, instance_npcname(strnpcinfo(0)) + "::OnMobDead";	// MM_EVIL_SHADOW1
		areamonster 'map_tnm2$,(.@x-1),(.@y-1),(.@x+1),(.@y+1),"Evil Shadow",2940,2, instance_npcname(strnpcinfo(0)) + "::OnMobDead";	// MM_EVIL_SHADOW2
		if ('round[.@num] == 7)
			stopnpctimer;
	}
	end;
OnTimer30000:
	donpcevent instance_npcname("devil_seal_spawn#" + strnpcinfo(2)) + "::OnStart";
	end;

OnDisable:
	stopnpctimer;
	killmonster 'map_tnm2$, instance_npcname(strnpcinfo(0)) + "::OnMobDead";	// note : officially still alive
	killmonster 'map_tnm2$, instance_npcname("#devil_seal_dead") + "::OnSealDead" + strnpcinfo(2);	// note : officially still alive
	disablenpc instance_npcname(strnpcinfo(0));
	end;
OnStop:
	stopnpctimer;
	killmonster 'map_tnm2$, instance_npcname(strnpcinfo(0)) + "::OnMobDead";
	killmonster 'map_tnm2$, instance_npcname("#devil_seal_dead") + "::OnSealDead" + strnpcinfo(2);
	end;
OnMobDead:
	end;
}
1@tnm2,1,1,0	duplicate(devil_seal_spawn#1)	devil_seal_spawn#2	HIDDEN_WARP_NPC
1@tnm2,1,1,0	duplicate(devil_seal_spawn#1)	devil_seal_spawn#3	HIDDEN_WARP_NPC
1@tnm2,1,1,0	duplicate(devil_seal_spawn#1)	devil_seal_spawn#4	HIDDEN_WARP_NPC
1@tnm2,1,1,0	duplicate(devil_seal_spawn#1)	devil_seal_spawn#5	HIDDEN_WARP_NPC

1@tnm2,1,1,0	script	devil_seal_reach_center#1	HIDDEN_WARP_NPC,{
	end;
OnStart:
	enablenpc instance_npcname(strnpcinfo(0));
	initnpctimer;
	end;
OnTimer2000:
	npctalk "Demon Morocc: Kuh, ja, ja, ja ¡Piezas de mi poder! ¡Reúnete aquí de nuevo!", 'demon$;
	mapannounce 'map_tnm2$, "Demon Morocc: Kuh, ja, ja, ja ¡Piezas de mi poder! ¡Reúnete aquí de nuevo!", bc_map,0xFF0000;
	end;
OnTimer4000:
	npctalk "Thanatos: ¡Detienelo! ¡No permitas que se acerque!", 'thanatos$;
	mapannounce 'map_tnm2$, "Thanatos: ¡Detienelo! ¡No permitas que se acerque!!", bc_map,0xFF00;
	stopnpctimer;
	disablenpc instance_npcname(strnpcinfo(0));
	end;
}
1@tnm2,1,1,0	duplicate(devil_seal_reach_center#1)	devil_seal_reach_center#2	HIDDEN_WARP_NPC
1@tnm2,1,1,0	duplicate(devil_seal_reach_center#1)	devil_seal_reach_center#3	HIDDEN_WARP_NPC
1@tnm2,1,1,0	duplicate(devil_seal_reach_center#1)	devil_seal_reach_center#4	HIDDEN_WARP_NPC
1@tnm2,1,1,0	duplicate(devil_seal_reach_center#1)	devil_seal_reach_center#5	HIDDEN_WARP_NPC

1@tnm2,1,1,0	script	#devil_seal_dead	HIDDEN_WARP_NPC,{
	end;
OnSealDead1: callsub S_Sealdead,0;
OnSealDead2: callsub S_Sealdead,1;
OnSealDead3: callsub S_Sealdead,2;
OnSealDead4: callsub S_Sealdead,3;
OnSealDead5: callsub S_Sealdead,4;

S_Sealdead:
	'seal_id[ getarg(0) ] = 0;
	'seal_dead[ getarg(0) ] = 1;
	.@total_seal = 'seal_dead[0] + 'seal_dead[1] + 'seal_dead[2] + 'seal_dead[3] + 'seal_dead[4];
	if (.@total_seal == 3)
		mapannounce 'map_tnm2$, "Lucile: ¡Es muy temprano para cantar victoria! Hay sellos mágicos que aún no han sido destruidos.", bc_map,0xFF00;
	else if (.@total_seal != 5)
		mapannounce 'map_tnm2$, "Todavía hay sellos mágicos por destruir.", bc_map,0xFF00;
	else {
		donpcevent instance_npcname("#devil_seal_spawn_global") + "::OnStop";
		donpcevent instance_npcname("#devil_seal_timer") + "::OnStop";	// stop timer of npc #devil_flamecross as well
		for ( .@i = 0; .@i < 5; .@i++ )
			donpcevent instance_npcname("devil_seal_spawn#" + (.@i+1)) + "::OnDisable";// note: on official seals and slaves are alive
		mapannounce 'map_tnm2$, "Demon Morocc:No .. Esto no puede ser ... ¿Quién demonios ... eres tú?", bc_map,0xFF0000;
		npctalk "Demon Morocc: No .. Esto no puede ser ... ¿Quién demonios ... eres tú?!", 'demon$;
		initnpctimer;
	}
	end;
OnTimer3000:
	mapannounce 'map_tnm2$, "Thanatos: ¡Será la última vez para presumir! ¡¡¡Adiós!!!", bc_map,0xFF0000;
	npctalk "Thanatos: ¡Será la última vez para presumir! ¡¡¡Adiós!!!", 'thanatos$;
	end;
OnTimer5000:
	specialeffect EF_LORD,AREA, 'thanatos$;
	end;
OnTimer7000:
	stopnpctimer;
	disablenpc 'demon$;
	disablenpc 'thanatos$;
	disablenpc instance_npcname("Lucile#tnm03");
	enablenpc instance_npcname("Lucile#tnm04");
	enablenpc instance_npcname("#tnm3event01");
	enablenpc instance_npcname("Young Girl#tnm01");
	'devil_tower = 9;

	'demon$ = 'thanatos$ = "";
	'round[0] = 'round[1] = 'round[2] = 'round[3] = 'round[4] = 0;
	'seal_id[0] = 'seal_id[1] = 'seal_id[2] = 'seal_id[3] = 'seal_id[4] = 0;
	'seal_hp[0] = 'seal_hp[1] = 'seal_hp[2] = 'seal_hp[3] = 'seal_hp[4] = 0;
	'seal_dead[0] = 'seal_dead[1] = 'seal_dead[2] = 'seal_dead[3] = 'seal_dead[4] = 0;
	deletearray 'coord_seal_1[0],14;
	deletearray 'coord_seal_2[0],14;
	deletearray 'coord_seal_3[0],14;
	deletearray 'coord_seal_4[0],14;
	deletearray 'coord_seal_5[0],14;
	end;
}

1@tnm2,144,137,3	script	Lucile#tnm04	4_F_LUCILE,{
	if ('devil_tower < 9)
		end;
	if (isbegin_quest(7574) == 0) {
		if (isbegin_quest(7572) == 1)
			erasequest 7572;// Lucile...?
		if (isbegin_quest(7573) == 1)	// leader
			erasequest 7573;// Magic Swordman Thanatos
		setquest 7574;// Thanatos Tower
		mes "[Lucile]";
		mes "Creo que el poder de Demon Morocc para romper el sello ha colisionado con Thanatos.";
		cutin "tnm_lucile01.bmp",2;
		next;
		mes "[Lucile]";
		mes "Ha ido demasiado lejos en algún lugar del sur";
		mes "¿Irás allí?";
	}
	else {
		mes "[Lucile]";
		mes "La colisión de esos dos poderes ha sido demasiado grande.";
		mes "Pudo haber influido en el sur de Rune Midgard.";
	}
	next;
	if (select( "Follow.", "Stop." ) == 2) {
		mes "[Lucile]";
		mes "... ¿Supongo que esto es lo que puedes hacer?";
		cutin "tnm_lucile02.bmp",2;
		close3;
	}
	mes "[Lucile]";
	mes "Good luck.";
	close2;
	warp 'map_tnm3$,21,171;
	end;
}

// tnm3 Stairs 1
1@tnm3,21,171,0	script	#tnm3event01	HIDDEN_NPC,1,1,{
	end;
OnTouch:
	if ('devil_tower != 9)
		end;
	mes "";	// todo fix me "workinprogress"
	disablenpc instance_npcname("#tnm3event01");
	enablenpc instance_npcname("Young Girl#tnm01");
	sleep2 4000;
	mapannounce 'map_tnm3$, "Chica joven: Odin Preservarme! ¡¡Un demonio!! ¡Ayuadame!", bc_map,0xFF00;
	'mob_count = 12;
	initnpctimer;
	end;
OnTimer1000:
	monster 'map_tnm3$,33,171,"Evil Shadow",2939,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW1
	end;
OnTimer2000:
	monster 'map_tnm3$,39,172,"Evil Shadow",2939,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW1
	end;
OnTimer3000:
	monster 'map_tnm3$,34,177,"Evil Shadow",2940,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW2
	end;
OnTimer4000:
	monster 'map_tnm3$,36,176,"Evil Shadow",2940,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW2
	end;
OnTimer5000:
	monster 'map_tnm3$,37,175,"Evil Shadow",2940,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW2
	end;
OnTimer6000:
	monster 'map_tnm3$,37,173,"Evil Shadow",2941,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW3
	monster 'map_tnm3$,36,172,"Evil Shadow",2941,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW3
	end;
OnTimer7000:
	monster 'map_tnm3$,29,178,"Evil Shadow",2941,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW3
	monster 'map_tnm3$,35,172,"Evil Shadow",2941,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW3
	end;
OnTimer8000:
	monster 'map_tnm3$,34,173,"Evil Shadow",2941,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW3
	monster 'map_tnm3$,35,172,"Evil Shadow",2939,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW1
	end;
OnTimer9000:
	monster 'map_tnm3$,34,173,"Evil Shadow",2941,1, instance_npcname("Young Girl#tnm01") + "::OnMobDead";// MM_EVIL_SHADOW3
	stopnpctimer;
	end;
}

1@tnm3,43,175,3	script	Young Girl#tnm01	4_F_DST_CHILD,{
	if ('devil_tower < 9)
		end;
	if ('devil_tower == 9) {
		mes "[Young Girl]";
		mes "¿Por qué hay demonios en el castillo ?!";
		mes "¡AYÚDEME!";
		close;
	}
	if ('devil_tower == 10) {
		if (getpartyleader(getcharid(1),2) != getcharid(0)) {
			mes "[Young Girl]";
			mes "* llanto * Los demonios son tan atemorizantes";
			close;
		}
		mes "[Young Girl]";
		mes "¿Por qué vendrían los demonios de repente?";
		mes "muchos guardias están heridos";
		npctalk "Joven: ¿Por qué demonios vendrían de repente, muchos guardias están heridos";
		next;
		select ("¿Dónde están?");
		unittalk getcharid (3), "" + strcharinfo (0) + ": ¿Dónde están?";
		mes "[Niña]";
		mes "Están en el castillo de Morroc. Mi padre es un caballero";
		npctalk "Están en el castillo de Morroc. Mi padre es un caballero";
		next;
		mes "[Niña]";
		mes "Parece que algo está sucediendo, escucho ruidos extraños abajo";
		npctalk "Jovencita: parece que algo está sucediendo, escucho ruidos extraños abajo";
		next;
		mes "[Niña]";
		mes "Vi entrar a algunos tipos de negro. ¿Qué está pasando en el castillo?";
		npctalk "Jovencita: Vi entrar a algunos tipos de negro. ¿Qué está pasando en el castillo?";
		next;
		mes "[Niña]";
		mes "Papa ... Papa, por favor, estate a salvo. * sollozo *";
		mes "Por favor, ven conmigo a través del pasaje detrás de ese estante!";
		npctalk "Jovencita: por favor, ven conmigo a través del pasaje detrás de ese estante!";
		close2;
		enablenpc instance_npcname("#tnm3gate01");
		enablenpc instance_npcname("#tnm3event02ect");
		'devil_tower = 11;
		end;
	}
	if ('devil_tower == 11) {
		mes "[Young Girl]";
		mes "¡Detrás de ese estante hay un pasaje secreto al sótano!";
		mes "Por favor, ven conmigo para asegurarte de que mi papá esté a salvo";
		close;
	}
	end;

OnMobDead:
	'mob_count--;
	if ('mob_count == 0) {
		'devil_tower = 10;
		npctalk "Joven: gracias por salvarme ... pero ¿por qué hay un demonio?";
	}
	end;
}

1@tnm3,52,176,0	warp	#tnm3gate01	2,2,1@tnm3,85,178

// tnm3 Stairs 2
1@tnm3,85,178,0	script	#tnm3event02ect	HIDDEN_NPC,1,1,{
	end;
OnTouch:
	if ('devil_tower != 11)
		end;
	disablenpc instance_npcname("#tnm3event02ect");
	enablenpc instance_npcname("Young Girl#tnm02");
	npctalk "Jovencita: ¡mira! ¡Más demonios, abrumarán el castillo pronto!", instance_npcname("Young Girl#tnm02");
	'mob_count = 18;
	initnpctimer;
	end;
OnTimer1000:
	.@label$ = instance_npcname("Young Girl#tnm02") + "::OnMobDead";
	monster 'map_tnm3$,97,174,"Evil Shadow",2939,1, .@label$;
	monster 'map_tnm3$,98,175,"Evil Shadow",2939,1, .@label$;
	monster 'map_tnm3$,100,166,"Evil Shadow",2939,1, .@label$;
	monster 'map_tnm3$,108,171,"Evil Shadow",2940,1, .@label$;
	monster 'map_tnm3$,104,172,"Evil Shadow",2940,1, .@label$;
	end;
OnTimer3000:
	.@label$ = instance_npcname("Young Girl#tnm02") + "::OnMobDead";
	monster 'map_tnm3$,109,169,"Evil Shadow",2941,1, .@label$;
	monster 'map_tnm3$,111,173,"Evil Shadow",2941,1, .@label$;
	monster 'map_tnm3$,113,167,"Evil Shadow",2941,1, .@label$;
	monster 'map_tnm3$,101,176,"Evil Shadow",2939,1, .@label$;
	monster 'map_tnm3$,116,170,"Evil Shadow",2941,1, .@label$;
	end;
OnTimer5000:
	.@label$ = instance_npcname("Young Girl#tnm02") + "::OnMobDead";
	monster 'map_tnm3$,107,175,"Evil Shadow",2940,1, .@label$;
	monster 'map_tnm3$,106,174,"Evil Shadow",2940,1, .@label$;
	monster 'map_tnm3$,106,169,"Evil Shadow",2939,1, .@label$;
	monster 'map_tnm3$,103,177,"Evil Shadow",2940,1, .@label$;
	end;
OnTimer7000:
	stopnpctimer;
	.@label$ = instance_npcname("Young Girl#tnm02") + "::OnMobDead";
	monster 'map_tnm3$,121,171,"Evil Shadow",2941,1, .@label$;
	monster 'map_tnm3$,119,173,"Evil Shadow",2941,1, .@label$;
	monster 'map_tnm3$,127,166,"Evil Shadow",2941,1, .@label$;
	monster 'map_tnm3$,125,166,"Evil Shadow",2941,1, .@label$;
	end;
}

1@tnm3,89,179,4	script	Young Girl#tnm02	4_F_DST_CHILD,{
	end;
OnMobDead:
	'mob_count--;
	if ('mob_count == 0) {
		mapannounce 'map_tnm3$, "Chica Joven: ¡El camino subterráneo se encuentra a lo largo de este pasillo!", bc_map,0xFF00;
		disablenpc instance_npcname("Young Girl#tnm02");
		enablenpc instance_npcname("Young Girl#tnm03");
		npctalk "Chica Joven: ¡El camino subterráneo se encuentra a lo largo de este pasillo!", instance_npcname("Young Girl#tnm03");
		enablenpc instance_npcname("#tnm3gate02");
		enablenpc instance_npcname("Evil Shadow#tnm3mob01");
	}
	end;
}

1@tnm3,128,164,3	script	Young Girl#tnm03	4_F_DST_CHILD,{
		mes "[Niña]";
		mes "De aquí ... no sé bien ...";
		mes "Veo tantas escaleras ...";
		mes "Mira, hay tantos demonios. ¡Mi padre correrá peligro!";
		mes "Por favor guárdalo";
	close;
}

1@tnm3,134,156,0	warp	#tnm3gate02	1,1,1@tnm3,169,165

// tnm3 Stairs 3
1@tnm3,179,172,3	script	Evil Shadow#tnm3mob01	2941,4,4,{
	end;
OnTouch_:
	if ('devil_tower == 11) {
		'devil_tower = 12;
		mes "";	// todo fix me "workinprogress"
		sleep2 1000;
		npctalk "Evil Shadow: Pensé que olía a ratas entrar furtivamente aquí. ¡¡Yo tenía razón!!";
		sleep2 3000;
		npctalk "Evil Shadow: lamentarás tu curiosidad e interferencia. ¡Hora de alimentar!";
		sleep2 3000;
		npctalk "Evil Shadow: ¡convoco a la Oscuridad!";
		disablenpc instance_npcname("Evil Shadow#tnm3mob01");
		donpcevent instance_npcname("Evil Shadow kill#tnm3mob01") + "::OnSummon";
	}
	end;
}

1@tnm3,1,1,0	script	Evil Shadow kill#tnm3mob01	HIDDEN_WARP_NPC,{
	end;
OnSummon:
	enablenpc instance_npcname("Evil Shadow kill#tnm3mob01");
	'mob_count = 5;
	initnpctimer;
	monster 'map_tnm3$,179,172, "Evil Shadow",2941,1, instance_npcname("Evil Shadow kill#tnm3mob01") + "::OnMobDead";// MM_EVIL_SHADOW3
	end;
OnTimer1000:
	monster 'map_tnm3$,181,172, "Evil Shadow",2940,1, instance_npcname("Evil Shadow kill#tnm3mob01") + "::OnMobDead";// MM_EVIL_SHADOW2
	monster 'map_tnm3$,178,172, "Evil Shadow",2940,1, instance_npcname("Evil Shadow kill#tnm3mob01") + "::OnMobDead";
	end;
OnTimer2000:
	monster 'map_tnm3$,179,172, "Evil Shadow",2939,1, instance_npcname("Evil Shadow kill#tnm3mob01") + "::OnMobDead";// MM_EVIL_SHADOW1
	monster 'map_tnm3$,176,173, "Evil Shadow",2939,1, instance_npcname("Evil Shadow kill#tnm3mob01") + "::OnMobDead";
	stopnpctimer;
	end;
OnMobDead:
	'mob_count--;
	if ('mob_count == 0) {
		enablenpc instance_npcname("#tnm3gate03");
		enablenpc instance_npcname("Demonic Shade#mobmaster");
		enablenpc instance_npcname("Morocc Lord Knight#mocl");
		enablenpc instance_npcname("Loki#tnmloki01");
	}
	end;
}

1@tnm3,183,177,0	warp	#tnm3gate03	1,1,1@tnm3,97,6

// Demonic Shade (Boss room)
1@tnm3,97,18,3	script	Demonic Shade#mobmaster	2939,5,5,{
	end;
OnTouch_:// possibility to skip this step
	if ('devil_tower < 12)
		end;
	if ('shade == 0) {
		'shade = 1;
		mes "";	// todo fix me "workinprogress"
		sleep2 1000;
		npctalk "Demonic Shade: ¡Entonces ustedes son los que causan problemas!";
		sleep2 2000;
		npctalk "Demonic Shade: Tsk, no podrías ni siquiera lograr proteger ... lo que sea ... todos morirán aquí.";
		sleep2 3000;
		npctalk "Sombra Demoníaca: ¡La verdad eterna es que convertiré tus muertes en la vida de Masin con la sangre de tus corazones!";
		disablenpc instance_npcname("Demonic Shade#mobmaster");
		donpcevent instance_npcname("#mobmaster_kill") + "::OnSummon";
	}
	end;
}

1@tnm3,1,1,0	script	#mobmaster_kill	HIDDEN_WARP_NPC,{
	end;
OnSummon:
	enablenpc instance_npcname("#mobmaster_kill");
	initnpctimer;
	monster 'map_tnm3$,97,18, "Demonic Shade",2939,1, instance_npcname("#mobmaster_kill") + "::OnMobDead";
	end;
OnTimer1000:
	.@label$ = instance_npcname("#mobmaster_kill") + "::OnMobDead";
	stopnpctimer;
	monster 'map_tnm3$,94,18, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,96,18, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,113,18, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,119,22, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,116,18, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,116,18, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,114,12, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,116,21, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,74,18, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,75,12, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,76,21, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,69,16, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,57,43, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,58,44, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,59,46, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,60,48, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,56,45, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,57,44, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,80,71, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,59,77, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,77,73, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,77,72, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,59,70, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,81,66, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,60,69, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,57,73, "Demonic Shade",2940,1, .@label$;
	monster 'map_tnm3$,62,74, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,78,67, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,75,22, "Demonic Shade",2941,1, .@label$;
	monster 'map_tnm3$,81,69, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,77,11, "Demonic Shade",2939,1, .@label$;
	monster 'map_tnm3$,58,74, "Demonic Shade",2941,1, .@label$;
	end;

OnMobDead:
	end;
}

1@tnm3,93,52,4	script	Morocc Lord Knight#mocl	1_M_MOC_LORD,{
	mes "[Morocc Lord Knight]";
	mes "¡Eran las ratas que estaban furtivamente por aquí!";
	close;
}

1@tnm3,97,48,3	script	Loki#tnmloki01	4_M_ROKI2,{
	if ('devil_tower == 12) {
		'devil_tower = 13;
		donpcevent instance_npcname("#morroc_lord_talk") + "::OnStart";
		end;
	}
	mes "[Loki]";
	mes "You have no power here.";
	close;
}

1@tnm3,94,51,4	duplicate(Officer Heim#heim0)	Young Girl#tnm04	4_F_DST_CHILD

1@tnm2,1,1,0	script	#morroc_lord_talk	HIDDEN_WARP_NPC,{
	end;
OnStart:
	enablenpc instance_npcname("#morroc_lord_talk");
	'morroc$ = instance_npcname("Morocc Lord Knight#mocl");
	'loki$ = instance_npcname("Loki#tnmloki01");
	npctalk "Morroc Lord Knight: Entonces ... ¿la rata era un asesino? ¿Viniste aquí a morir?", 'morroc$;
	initnpctimer;
	end;
OnTimer3000:
	npctalk "Loki: ¿Qué lograrás al despertar al Masin en el Muro?", 'loki $;
	end;
OnTimer6000:
	npctalk "Loki: Mi misión me trajo aquí para enterrarlo de nuevo", 'loki $;
	end;
OnTimer9000:
	npctalk "Morocc Lord Knight: Realmente ... el gremio Assassin, que pensé que estaba en una misión para equilibrar el poder en el mundo", 'morroc $;
	end;
OnTimer12000:
	npctalk "Morocc Lord Knight: ¡Resucitar al demonio traería equilibrio! Incluso los más poderosos se convertirían en esclavos de un dios ...", 'morroc $;
	end;
OnTimer15000:
	npctalk "Morocc Lord Knight: Los dioses tienen sus propios planes. ¿Sabes lo que los dioses planean para ti o para mí?", "morroc $;
	end;
OnTimer18000:
	npctalk "Morocc Lord Knight: Quieren que este mundo sea solo a su imagen. ¿Dónde encajamos en eso?", "morroc $;
	end;
OnTimer20000:
	npctalk "Loki: ¡Cállate!", "loki $;
	end;
OnTimer22000:
	npctalk "Loki: No me importan los dioses o los demonios o los planes que han hecho. Lo único que importa es matarte", 'loki $;
	end;
OnTimer25000:
	npctalk "Loki: ¡Esa es mi misión!", "loki $;
	end;
OnTimer28000:
	npctalk "Morocc Lord Knight: ¿Entonces todo lo que quieres es terminar tu maldita misión? ...", 'morroc $;
	end;
OnTimer31000:
	npctalk "Loki: * sonríe * ¡Por supuesto!", 'loki $;
	specialeffect EF_BEGINSPELL3, AREA, 'loki $;
	end;
OnTimer33000:
	npctalk "Loki: Mind blaster - !!!", "loki $;
	end;
OnTimer34000:
	enablenpc instance_npcname ("Jovencita # tnm04");
	npctalk "Young Girl: No ... ¡¡¡No lastimes a mi papá !!!", instance_npcname ("Young Girl # tnm04");
	specialeffect EF_HIT3, AREA, instance_npcname ("Chica joven # tnm04");
	end;
OnTimer34500:
	specialeffect EF_HIT2, AREA, instance_npcname ("Young Girl # tnm04");
	end;
OnTimer35500:
	specialeffect EF_ICECRASH, AREA, instance_npcname ("Young Girl # tnm04");
	end;
OnTimer36500:
	npctalk "!!!", "loki $;
	end;
OnTimer38500:
	npctalk "Morocc Lord Knight: Oh no ... Deberían haber enviado mejor que usted, Sr. Assassin, para esta misión.", 'morroc $;
	end;
OnTimer41500:
	npctalk "Young Girl: Algo está mal ...", instance_npcname ("Young Girl # tnm04");
	end;
OnTimer44500:
	npctalk "Joven: Mi papá nunca actuaría de esta manera ... Ugh ...", instance_npcname ("Young Girl # tnm04");
	end;
OnTimer47500:
	npctalk "Morocc Lord Knight: Human ... Hacer una cosa tan estúpida ... un sacrificio", 'morroc $;
	end;
OnTimer50500:
	npctalk "Morocc Lord Knight: Sabes, la verdad es que es inútil.", 'morroc $;
	end;
OnTimer53500:
npctalk "Morocc Lord Knight: Gwuaaa jajajaja. ¡Estúpidos humanos los mataré a todos como sacrificio por el demonio!", 'morroc $;
	specialeffect EF_COUPLECASTING,AREA, 'morroc$;
	specialeffect EF_VOLCANO,AREA, 'morroc$;
	end;
OnTimer54500:
	npctalk "Loki:... tsk! inutiles....!", 'loki$;
	end;
OnTimer55500:
	enablenpc instance_npcname("Loki#tnmloki02");
	mapwarp 'map_tnm3$, 'map_tnm3$,136,62;// todo area 1x1
	'devil_tower = 13;
	stopnpctimer;
	disablenpc instance_npcname("#morroc_lord_talk");
	disablenpc instance_npcname("Morocc Lord Knight#mocl");
	disablenpc instance_npcname("Loki#tnmloki01");
	disablenpc instance_npcname("Young Girl#tnm04");
	end;
}

1@tnm3,137,65,3	script	Loki#tnmloki02	4_M_ROKI2,{
	if ('devil_tower != 13)
		end;
	if (getpartyleader(getcharid(1),2) != getcharid(0)) {
		mes "[Loki]";
		mes "Estoy hablando con el lider del grupo.";
		close;
	}
	if (getmercinfo(0) > 0) {
		mes "[Loki]";
		mes "... embarazoso.";
		mes "Debes ^4d4dffTerminar el contrato mercenario ^000000, si quieres ayudarme en esta misión.";
		close;
	}
	mes "[Loki]";
	mes "¿De dónde vienes?";
	mes "Necesito ayuda aquí.";
	npctalk "Loki: ¿De dónde vienes? Necesito ayuda aquí.", instance_npcname ("Loki # tnmloki02");
	next;
	mes "[Loki]";
	mes "El Lord Knight ya no es humano. Tengo que enviarlo a su eternidad por sus seguidores demoníacos";
	npctalk "Loki: Lord Knight ya no es humano. Tengo que enviarlo a su eternidad", instance_npcname ("Loki # tnmloki02");
	next;
	mes "[Loki]";
	mes "^4d4dffLos que son infernalmente bendecidos por demonios son invencibles. Podemos cortar la bendición con Mind Blaster. ^000000";
	npctalk "Loki: Los que son infernalmente bendecidos por los demonios son invencibles. Podemos cortar la bendición con Mind Blaster.", instance_npcname ("Loki # tnmloki02");
	next;
	mes "[Loki]";
	mes "Estarás a cargo de activar Mind Blaster.";
	npctalk "Loki: estarás a cargo de activar Mind Blaster.", instance_npcname ("Loki # tnmloki02");
	next;
	disablenpc instance_npcname ("Loki # tnmloki02");
	mes "^4d4dffLoki, Guillotine Cross of the Assassin Guild, se ha unido a tu grupo.";
	mes "Tenemos que deshacernos del demoníaco Lord Knight por Mind Blasting él con la habilidad de Loki. ^000000";
	'devil_tower = 14;
	mercenary_create 2937,1800000; // M_LOKI
	mapannounce 'map_tnm3 $, "Voz del Devoto del Demonio: ¡Qué basura! ¿Dónde te escondiste?", bc_map, 0xFF00;
	initnpctimer;
	close;
OnTimer500:
	monster 'map_tnm3$,93,52,"Evil Believer",2942,1, instance_npcname("#boss_skills_timer") + "::OnBossDead";// MM_EVIL_FANATICS
	'boss_id = $@mobid[0];
	end;
OnTimer2000:
	mapannounce 'map_tnm3$, "Demon Worshipper's Voice: ¡Todos ustedes serán sacrificados para despertar a Masin!", bc_map,0xFF00;
	end;
OnTimer12000:
	donpcevent instance_npcname("#boss_skills_timer") + "::OnStart";
	stopnpctimer;
	end;
}

1@tnm3,1,1,0	script	#boss_skills_timer	HIDDEN_WARP_NPC,{
	end;
OnStart:
	enablenpc instance_npcname("#boss_skills_timer");
	'label$ = instance_npcname("#boss_skills_timer") + "::OnMobDead";
	initnpctimer;
	end;
OnTimer1000:// + form
	getunitdata 'boss_id, .@data;
	'x_boss = .@data[UMOB_X];
	'y_boss = .@data[UMOB_Y];
	monster 'map_tnm3$, 'x_boss, 'y_boss, "",2943,1, 'label$;// MM_ICE_MINE
	monster 'map_tnm3$, ('x_boss-5), 'y_boss, "",2943,1, 'label$;
	monster 'map_tnm3$, ('x_boss+5), 'y_boss, "",2943,1, 'label$;
	monster 'map_tnm3$, 'x_boss, ('y_boss-5), "",2943,1, 'label$;
	monster 'map_tnm3$, 'x_boss, ('y_boss+5), "",2943,1, 'label$;
	end;
OnTimer3000:
	monster 'map_tnm3$, ('x_boss-10), 'y_boss, "",2943,1, 'label$;// MM_ICE_MINE
	monster 'map_tnm3$, ('x_boss+10), 'y_boss, "",2943,1, 'label$;
	monster 'map_tnm3$, 'x_boss, ('y_boss-10), "",2943,1, 'label$;
	monster 'map_tnm3$, 'x_boss, ('y_boss+10), "",2943,1, 'label$;
	end;
OnTimer6000:
	killmonster 'map_tnm3$, 'label$;
	end;
OnTimer21000:// X form
	getunitdata 'boss_id, .@data;
	'x_boss = .@data[UMOB_X];
	'y_boss = .@data[UMOB_Y];
	monster 'map_tnm3$, ('x_boss+3), ('y_boss+3), "",2960,1, 'label$;// MM_FLAMECROSS
	monster 'map_tnm3$, ('x_boss+3), ('y_boss-3), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-3), ('y_boss+3), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-3), ('y_boss-3), "",2960,1, 'label$;
	end;
OnTimer21350:
	monster 'map_tnm3$, ('x_boss+6), ('y_boss+6), "",2960,1, 'label$;// MM_FLAMECROSS
	monster 'map_tnm3$, ('x_boss+6), ('y_boss-6), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-6), ('y_boss+6), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-6), ('y_boss-6), "",2960,1, 'label$;
	end;
OnTimer21700:
	monster 'map_tnm3$, ('x_boss+9), ('y_boss+9), "",2960,1, 'label$;// MM_FLAMECROSS
	monster 'map_tnm3$, ('x_boss+9), ('y_boss-9), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-9), ('y_boss+9), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-9), ('y_boss-9), "",2960,1, 'label$;
	end;
OnTimer22050:
	monster 'map_tnm3$, ('x_boss+13), ('y_boss+13), "",2960,1, 'label$;// MM_FLAMECROSS
	monster 'map_tnm3$, ('x_boss+13), ('y_boss-13), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-13), ('y_boss+13), "",2960,1, 'label$;
	monster 'map_tnm3$, ('x_boss-13), ('y_boss-13), "",2960,1, 'label$;
	end;
OnTimer30000:
	killmonster 'map_tnm3$, 'label$;
	end;
OnTimer51000:// X form
	getunitdata 'boss_id, .@data;
	'x_boss = .@data[UMOB_X];
	'y_boss = .@data[UMOB_Y];
	monster 'map_tnm3$, 'x_boss, 'y_boss, "",2943,1, 'label$;// MM_ICE_MINE
	monster 'map_tnm3$, ('x_boss+5), ('y_boss+5), "",2943,1, 'label$;
	monster 'map_tnm3$, ('x_boss-5), ('y_boss-5), "",2943,1, 'label$;
	monster 'map_tnm3$, ('x_boss+10), ('y_boss+10), "",2943,1, 'label$;
	monster 'map_tnm3$, ('x_boss-10), ('y_boss-10), "",2943,1, 'label$;
	end;
OnTimer53000:
	monster 'map_tnm3$, ('x_boss-5), ('y_boss+5), "",2943,1, 'label$;// MM_ICE_MINE
	monster 'map_tnm3$, ('x_boss+5), ('y_boss-5), "",2943,1, 'label$;
	monster 'map_tnm3$, ('x_boss-10), ('y_boss+10), "",2943,1, 'label$;
	monster 'map_tnm3$, ('x_boss+10), ('y_boss-10), "",2943,1, 'label$;
	end;
OnTimer56000:
	killmonster 'map_tnm3$, 'label$;
	end;
OnTimer81000:// S form
	getunitdata 'boss_id, .@data;
	'x_boss = .@data[UMOB_X];
	'y_boss = .@data[UMOB_Y];
	monster 'map_tnm3$, ('x_boss-2), ('y_boss+5), "",2960,1, 'label$;// MM_FLAMECROSS
	end;
OnTimer81300:
	monster 'map_tnm3$, ('x_boss+4), ('y_boss+8), "",2960,1, 'label$;
	end;
OnTimer81600:
	monster 'map_tnm3$, ('x_boss+10), ('y_boss+2), "",2960,1, 'label$;
	end;
OnTimer82000:
	monster 'map_tnm3$, ('x_boss+10), ('y_boss-1), "",2960,1, 'label$;
	end;
OnTimer82300:
	monster 'map_tnm3$, ('x_boss+7), ('y_boss-7), "",2960,1, 'label$;
	end;
OnTimer82600:
	monster 'map_tnm3$, ('x_boss+1), ('y_boss-10), "",2960,1, 'label$;
	end;
OnTimer83000:
	monster 'map_tnm3$, ('x_boss-11), ('y_boss-1), "",2960,1, 'label$;
	end;
OnTimer83300:
	monster 'map_tnm3$, ('x_boss-11), ('y_boss+5), "",2960,1, 'label$;
	end;
OnTimer83600:
	monster 'map_tnm3$, ('x_boss-8), ('y_boss+11), "",2960,1, 'label$;
	end;
OnTimer84000:
	monster 'map_tnm3$, ('x_boss-2), ('y_boss+17), "",2960,1, 'label$;
	end;
OnTimer84300:
	monster 'map_tnm3$, ('x_boss+7), ('y_boss+20), "",2960,1, 'label$;
	end;
OnTimer90000:
	killmonster 'map_tnm3$, 'label$;
	initnpctimer;
	end;
OnMobDead:
	end;
OnBossDead:
	stopnpctimer;
	killmonster 'map_tnm3$, 'label$;
	'x_boss = 'y_boss = 'boss_id = 0;
	'label$ = "";
	mapannounce 'map_tnm3$, "Demon Worshipper's Voice: NO es imposible. No puede ser ... Esta fuerza ... poder ... tú ... puedes ... ser tú ...", bc_map,0xFF0000;
	sleep2 1000;
	warpparty 'map_tnm3$,71,70, getcharid(1), 'map_tnm3$,1,1;
	enablenpc instance_npcname("Loki#tnmloki03");
	enablenpc instance_npcname("box#tnmbosang");
	disablenpc instance_npcname("#boss_skills_timer");
	'devil_tower = 15;
	end;
}

1@tnm3,69,70,3	script	box#tnmbosang	4_TREASURE_BOX,{
	if ('devil_tower != 15)
		end;
	specialeffect EF_COIN;
	disablenpc instance_npcname("box#tnmbosang");
	makeitem 7293,1, 'map_tnm3$, (69 + rand(-5,5)), (70 + rand(-5,5));	// Rose Quartz
	makeitem 749,1, 'map_tnm3$, (69 + rand(-5,5)), (70 + rand(-5,5));	// Frozen Rose
	makeitem 7511,1, 'map_tnm3$, (69 + rand(-5,5)), (70 + rand(-5,5));	// Rune of Darkness
	if (rand(100) < 75)
		makeitem 616,1, 'map_tnm3$, (69 + rand(-5,5)), (70 + rand(-5,5));	// Old Card Album
	if (rand(100) < 50)
		makeitem 748,1, 'map_tnm3$, (69 + rand(-5,5)), (70 + rand(-5,5));	// Witherless_Rose

	setarray .@item_id_list[0],
		1671,	// Devil_Won_Staff
		13094,	// Devil_Pierced_Dagger
		16027,	// Hammer_Of_Evil_Slayer
		18120, 	// Bow_Of_Evil_Slayer
		21010, 	// Tw_Sword_Of_Evil_Slayer
		28001; 	// Katar_Of_Evil_Slayer
	setarray .@bonus_list1[0],
		4800,	// SP50
		4811,	// Fighting_Spirit1
		4810,	// Fighting_Spirit2
		4809,	// Fighting_Spirit3
		4808,	// Fighting_Spirit4
		4820,	// Fighting_Spirit5
		4821,	// Fighting_Spirit6
		4815,	// Spell1
		4814,	// Spell2
		4813,	// Spell3
		4812,	// Spell4
		4786;	// Mdef2
	setarray .@bonus_list2[0],
		4815,	// Spell1
		4814,	// Spell2
		4813,	// Spell3
		4812,	// Spell4
		4826,	// Spell5
		4811,	// Fighting_Spirit1
		4810,	// Fighting_Spirit2
		4809,	// Fighting_Spirit3
		4808,	// Fighting_Spirit4
		4820,	// Fighting_Spirit5
		4786;	// Mdef2
	setarray .@bonus_list3[0],
		4815,	// Spell1
		4814,	// Spell2
		4813,	// Spell3
		4812,	// Spell4
		4811,	// Fighting_Spirit1
		4810,	// Fighting_Spirit2
		4809,	// Fighting_Spirit3
		4808,	// Fighting_Spirit4
		4820,	// Fighting_Spirit5
		4821,	// Fighting_Spirit6
		4791,	// DEF+3
		4786;	// Mdef2
	.@item_id = .@item_id_list[ rand( getarraysize(.@item_id_list) ) ];
	.@refine = rand(1,6);
	.@bonus1 = .@bonus_list1[ rand( getarraysize(.@bonus_list1) ) ];
	.@bonus2 = .@bonus_list1[ rand( getarraysize(.@bonus_list2) ) ];
	.@bonus3 = .@bonus_list1[ rand( getarraysize(.@bonus_list3) ) ];

	makeitem2 .@item_id,1, 'map_tnm3$, (69 + rand(-5,5)), (70 + rand(-5,5)), 0, .@refine,0, 0,.@bonus1,.@bonus2,.@bonus3;
	end;
}

//1@tnm3,69,72,3	script	Loki#tnmloki03	4_M_ROKI2,5,5,{
1@tnm3,69,72,3	script	Loki#tnmloki03	4_M_ROKI2,{
	if ('devil_tower != 15)
		end;
	if (isbegin_quest(7576) == 0) {
		mes "[Loki]";
		mes "... molesto";
		mes "El demonio fue destruido antes de que se completara la ceremonia de resurrección";
		mes "Las cosas estarán bien por un tiempo";
		setquest 7576;// Morocc castle seal
		next;
		mes "He obtenido información inesperada durante mi exploración de la Torre";
		next;
		mes "[Loki]";
		mes "Me mantendré alejado de mi conciencia por un tiempo más";
		mes "algún día me volveré a sentir y hoy ocuparé mis pensamientos ...";
		close;
	}
	mes "[Loki]";
	mes "Interesante ... hay una hija ...";
	mes "¿Qué se debe hacer al respecto?";
	mes "No estoy seguro de cuál será mi próximo movimiento ...";
	next;
	mes "[Loki]";
	mes "Pero no importa, obviamente no deberías estar aquí, ahora.";
	mes "¿Permanecerás aquí más tiempo?";
	mes "Puedo enviarte de regreso a donde y cuando perteneces";
	next;
	if (seleccione ("Salir de aquí.", "Echar un vistazo alrededor") == 2) {
	mes "[Loki]";
	mes "No es prudente permanecer aquí donde el tiempo está distorsionado";
	close;
	}
mes "[Loki]";
mes "Tal vez, nuestras misiones nos aliarán nuevamente en el futuro ...";
	close2;
	warp "dali02",134,112;
	end;

OnInstanceInit:
	'heal_count = 0;
	'devil_tower = 0;
	'mob_count = 0;
	'shade = 0;

	'map_tnm1$ = instance_mapname("1@tnm1");
	'map_tnm2$ = instance_mapname("1@tnm2");
	'map_tnm3$ = instance_mapname("1@tnm3");

	// Entrance
	disablenpc instance_npcname("Officer Heim#heim");
	disablenpc instance_npcname("Healer Fama#feima");
	for ( .@i = 1; .@i < 8; .@i++ )
		disablenpc instance_npcname( "Injured Soldier#" + .@i );
	disablenpc instance_npcname("Lucile#tnm01");
	disablenpc instance_npcname("Magic Swordman#tnm01");
	disablenpc instance_npcname("Assassin Huey#tnm01");
	disablenpc instance_npcname("Assassin Louie#tnm01");
	disablenpc instance_npcname("Assassin Dewey#tnm01");

	// Stairs tnm1
	disablenpc instance_npcname("#tnm1stepmob");
	disablenpc instance_npcname("Assassin Louie#tnm02");

	// Stairs 2 tnm1
	disablenpc instance_npcname("Lucile#tnm02");
	disablenpc instance_npcname("Huey#hui02");

	// Morocc - Thanatos Battle
	disablenpc instance_npcname("Magic Swordman#tnm02");
	disablenpc instance_npcname("Demon Morocc#tnm01");
	disablenpc instance_npcname("Lucile#tnm03");
	disablenpc instance_npcname("Lucile#tnm04");
	disablenpc instance_npcname("#devil_flamecross");
	disablenpc instance_npcname("#devil_seal_timer");
	disablenpc instance_npcname("#devil_seal_spawn_global");
	for ( .@i = 1; .@i < 6; .@i++ ) {
		disablenpc instance_npcname("devil_seal_spawn#" + .@i);
		disablenpc instance_npcname("devil_seal_reach_center#" + .@i);
	}
	disablenpc instance_npcname("#devil_seal_dead");

	'demon$ = 'thanatos$ = "";
	'round[0] = 'round[1] = 'round[2] = 'round[3] = 'round[4] = 0;
	'seal_id[0] = 'seal_id[1] = 'seal_id[2] = 'seal_id[3] = 'seal_id[4] = 0;
	'seal_hp[0] = 'seal_hp[1] = 'seal_hp[2] = 'seal_hp[3] = 'seal_hp[4] = 0;
	'seal_dead[0] = 'seal_dead[1] = 'seal_dead[2] = 'seal_dead[3] = 'seal_dead[4] = 0;
	deletearray 'coord_seal_1[0],14;
	deletearray 'coord_seal_2[0],14;
	deletearray 'coord_seal_3[0],14;
	deletearray 'coord_seal_4[0],14;
	deletearray 'coord_seal_5[0],14;

	// tnm3 Stairs 1
	disablenpc instance_npcname("#tnm3event01");
	disablenpc instance_npcname("Young Girl#tnm01");
	disablenpc instance_npcname("#tnm3gate01");

	// tnm3 Stairs 2
	disablenpc instance_npcname("#tnm3event02ect");
	disablenpc instance_npcname("Young Girl#tnm02");
	disablenpc instance_npcname("Young Girl#tnm03");
	disablenpc instance_npcname("#tnm3gate02");

	// tnm3 Stairs 3
	disablenpc instance_npcname("Evil Shadow#tnm3mob01");
	disablenpc instance_npcname("Evil Shadow kill#tnm3mob01");
	disablenpc instance_npcname("#tnm3gate03");

	// Demonic Shade (Boss room)
	disablenpc instance_npcname("Demonic Shade#mobmaster");
	disablenpc instance_npcname("#mobmaster_kill");

	// Boss
	disablenpc instance_npcname("Morocc Lord Knight#mocl");
	disablenpc instance_npcname("#morroc_lord_talk");
	disablenpc instance_npcname("Loki#tnmloki01");
	disablenpc instance_npcname("Young Girl#tnm04");
	disablenpc instance_npcname("Loki#tnmloki02");
	disablenpc instance_npcname("#boss_skills_timer");
	'x_boss = 'y_boss = 'boss_id = 0;
	'label$ = "";

	// Final
	disablenpc instance_npcname("Loki#tnmloki03");
	disablenpc instance_npcname("box#tnmbosang");
	end;
}
